(function(f,v){typeof exports=="object"&&typeof module<"u"?module.exports=v():typeof define=="function"&&define.amd?define(v):(f=typeof globalThis<"u"?globalThis:f||self,f.TGA=v())})(this,(function(){"use strict";function f(p){return p&&p.__esModule&&Object.prototype.hasOwnProperty.call(p,"default")?p.default:p}var v={exports:{}};var w;function T(){return w||(w=1,(function(p,E){var I;I=function(){function x(m,D){for(var y=0;y<D.length;y++){var t=D[y];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}return(function(){function m(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,m)}var D,y;return D=m,(y=[{key:"_checkHeader",value:function(){var t=this.header;if(t.imageType===0)throw Error("No data");if(t.hasColorMap){if(t.colorMapLength>256||t.colorMapDepth!==24||t.colorMapType!==1)throw Error("Invalid colormap for indexed type")}else if(t.colorMapType)throw Error("Why does the image contain a palette ?");if(!t.width||!t.height)throw Error("Invalid image size");if(t.pixelDepth!==8&&t.pixelDepth!==16&&t.pixelDepth!==24&&t.pixelDepth!==32)throw Error('Invalid pixel size "'+t.pixelDepth+'"')}},{key:"_decodeRLE",value:function(t,e,o,a){for(var h=new Uint8Array(a),g=new Uint8Array(o),s=0;s<a;){var l=t[e++],u=1+(127&l);if(128&l){for(var c=0;c<o;++c)g[c]=t[e+c];e+=o;for(var n=0;n<u;++n)h.set(g,s),s+=o}else{u*=o;for(var r=0;r<u;++r)h[s+r]=t[e+r];s+=u,e+=u}}return h}},{key:"_getImageData8bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n++){var d=e[n];t[4*(i+a*r)+3]=255,t[4*(i+a*r)+2]=o[3*d+0],t[4*(i+a*r)+1]=o[3*d+1],t[4*(i+a*r)+0]=o[3*d+2]}return t}},{key:"_getImageData16bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n+=2){var d=e[n+0]|e[n+1]<<8;t[4*(i+a*r)+0]=(31744&d)>>7,t[4*(i+a*r)+1]=(992&d)>>2,t[4*(i+a*r)+2]=(31&d)>>3,t[4*(i+a*r)+3]=32768&d?0:255}return t}},{key:"_getImageData24bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n+=3)t[4*(i+a*r)+3]=255,t[4*(i+a*r)+2]=e[n+0],t[4*(i+a*r)+1]=e[n+1],t[4*(i+a*r)+0]=e[n+2];return t}},{key:"_getImageData32bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n+=4)t[4*(i+a*r)+2]=e[n+0],t[4*(i+a*r)+1]=e[n+1],t[4*(i+a*r)+0]=e[n+2],t[4*(i+a*r)+3]=e[n+3];return t}},{key:"_getImageDataGrey8bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n++){var d=e[n];t[4*(i+a*r)+0]=d,t[4*(i+a*r)+1]=d,t[4*(i+a*r)+2]=d,t[4*(i+a*r)+3]=255}return t}},{key:"_getImageDataGrey16bits",value:function(t,e,o,a,h,g,s,l,u,c){for(var n=0,r=h;r!==s;r+=g)for(var i=l;i!==c;i+=u,n+=2)t[4*(i+a*r)+0]=e[n+0],t[4*(i+a*r)+1]=e[n+0],t[4*(i+a*r)+2]=e[n+0],t[4*(i+a*r)+3]=e[n+1];return t}},{key:"open",value:function(t,e){var o=this,a=new XMLHttpRequest;a.responseType="arraybuffer",a.open("GET",t,!0),a.onload=function(){a.status===200&&(o.load(new Uint8Array(a.response)),e&&e())},a.send(null)}},{key:"load",value:function(t){var e=0;if(t.length<18)throw Error("Not enough data to contain header");var o={idLength:t[e++],colorMapType:t[e++],imageType:t[e++],colorMapIndex:t[e++]|t[e++]<<8,colorMapLength:t[e++]|t[e++]<<8,colorMapDepth:t[e++],offsetX:t[e++]|t[e++]<<8,offsetY:t[e++]|t[e++]<<8,width:t[e++]|t[e++]<<8,height:t[e++]|t[e++]<<8,pixelDepth:t[e++],flags:t[e++]};if(o.hasEncoding=o.imageType===9||o.imageType===10||o.imageType===11,o.hasColorMap=o.imageType===9||o.imageType===1,o.isGreyColor=o.imageType===11||o.imageType===3,this.header=o,this._checkHeader(),(e+=o.idLength)>=t.length)throw Error("No data");if(o.hasColorMap){var a=o.colorMapLength*(o.colorMapDepth>>3);this.palette=t.subarray(e,e+a),e+=a}var h=o.pixelDepth>>3,g=o.width*o.height,s=g*h;o.hasEncoding?this.imageData=this._decodeRLE(t,e,h,s):this.imageData=t.subarray(e,e+(o.hasColorMap?g:s))}},{key:"getImageData",value:function(t){var e,o,a,h,g,s,l,u=this.header,c=u.width,n=u.height,r=u.flags,i=u.pixelDepth,d=u.isGreyColor,b=(48&r)>>4;switch(t||(t=document?document.createElement("canvas").getContext("2d").createImageData(c,n):{width:c,height:n,data:new Uint8ClampedArray(c*n*4)}),b===2||b===3?(h=0,g=1,s=n):(h=n-1,g=-1,s=-1),b===2||b===0?(e=0,o=1,a=c):(e=c-1,o=-1,a=-1),i){case 8:l=d?this._getImageDataGrey8bits:this._getImageData8bits;break;case 16:l=d?this._getImageDataGrey16bits:this._getImageData16bits;break;case 24:l=this._getImageData24bits;break;case 32:l=this._getImageData32bits}return l.call(this,t.data,this.imageData,this.palette,c,h,g,s,e,o,a),t}},{key:"getCanvas",value:function(){var t=this.header,e=t.width,o=t.height,a=document.createElement("canvas"),h=a.getContext("2d"),g=h.createImageData(e,o);return a.width=e,a.height=o,h.putImageData(this.getImageData(g),0,0),a}},{key:"getDataURL",value:function(t){return this.getCanvas().toDataURL(t||"image/png")}}])&&x(D.prototype,y),m})()},p.exports=I()})(v)),v.exports}var k=T();return f(k)}));
