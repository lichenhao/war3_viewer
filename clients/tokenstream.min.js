const N=new TextDecoder,O=new TextEncoder;function l(a){return N.decode(a)}function F(a){return O.encode(a)}function H(a){let t=a.length;for(let n=a.length-1;n>=0;n--){const r=a.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}function J(a,t){const n=[];let r=0,e=0;for(let s=0,i=a.length;s<i;s++){const d=a.charCodeAt(s);d<128?e+=1:d<2048?e+=2:d<55296||d>=57344?e+=3:(s++,e+=4),e>=t-3&&(n.push(a.substr(r,s)),r+=s,e=0)}return e>0&&n.push(a.substr(r)),n}function q(a){return a instanceof Uint8Array?a:typeof a=="string"?F(a):new Uint8Array(a)}function K(a,t,n=0,r=1/0){const e=Math.max(n,0),s=Math.min(e+r,a.length);let i=0,d=t.charCodeAt(0);for(let y=e;y<s;y++)if(a[y]===d){if(i+=1,i===t.length)return!0;d=t.charCodeAt(i)}else i>0&&(i=0,d=t.charCodeAt(0));return!1}function P(a,t,n=0,r=1/0){const e=Math.max(n,0),s=Math.min(e+r,a.length);let i=0,d=t[0];for(let y=e;y<s;y++)if(a[y]===d){if(i+=1,i===t.length)return!0;d=t[i]}else i>0&&(i=0,d=t[0]);return!1}function G(a,t,n=0,r=1/0){const e=Math.max(n,0),s=Math.min(e+r,a.length);for(let i=e;i<s;i++)if(a[i]===t)return i;return-1}const u=new ArrayBuffer(8),E=new Int8Array(u),T=new Int16Array(u),k=new Int32Array(u),o=new Uint8Array(u),C=new Uint16Array(u),c=new Uint32Array(u),V=new Float32Array(u),D=new Float64Array(u);function f(a){return o[0]=a,E[0]}function g(a,t){return o[0]=a,o[1]=t,T[0]}function m(a,t,n,r){return o[0]=a,o[1]=t,o[2]=n,o[3]=r,k[0]}function x(a,t){return o[0]=a,o[1]=t,C[0]}function b(a,t,n,r){return o[0]=a,o[1]=t,o[2]=n,o[3]=r,c[0]}function A(a,t,n,r){return o[0]=a,o[1]=t,o[2]=n,o[3]=r,V[0]}function $(a,t,n,r,e,s,i,d){return o[0]=a,o[1]=t,o[2]=n,o[3]=r,o[4]=e,o[5]=s,o[6]=i,o[7]=d,D[0]}function B(a){return o[0]=a,E[0]}function L(a,t){return T[0]=t,a[0]=o[0],a[1]=o[1],a}function w(a,t){return k[0]=t,a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a}function U(a,t){return C[0]=t,a[0]=o[0],a[1]=o[1],a}function p(a,t){return c[0]=t,a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a}function I(a,t){return V[0]=t,a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a}function S(a,t){return D[0]=t,a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[4]=o[4],a[5]=o[5],a[6]=o[6],a[7]=o[7],a}function Q(a){return c[0]=a,c[0]}function R(a){let t=0;for(const n of a)t=t*256+n.charCodeAt(0);return t}function W(a){const t=[];for(;a>0;)t.push(String.fromCharCode(a%256)),a=Math.floor(a/256);return t.reverse().join("")}const h=new Uint8Array(8);class M{buffer;uint8array;index=0;byteLength;remaining;constructor(t,n,r){const e=q(t);n=n||0,r=r||e.length,this.buffer=t,this.uint8array=e.subarray(n,n+r),this.byteLength=r,this.remaining=r}substream(t){if(this.remaining<t)throw new Error(`ByteStream: substream: want ${t} bytes but have ${this.remaining}`);const n=this.index;return this.index+=t,new M(this.uint8array.subarray(n,n+t))}skip(t){if(this.remaining<t)throw new Error(`ByteStream: skip: premature end - want ${t} bytes but have ${this.remaining}`);this.index+=t,this.remaining-=t}seek(t){this.index=t,this.remaining=this.byteLength-t}read(t){if(this.remaining<t)throw new Error(`ByteStream: read: premature end - want ${t} bytes but have ${this.remaining}`);const n=this.uint8array,r=this.index;let e=G(n,0,r,t);return e===-1&&(e=r+t),this.index+=t,this.remaining-=t,l(n.subarray(r,e))}readNull(){if(this.remaining<1)throw new Error("ByteStream: readNull: premature end - want at least 1 byte but have 0");const t=this.uint8array,n=this.index;let r=t.indexOf(0,n);r===-1&&(r=t.length-1);const e=r-n+1;return this.index+=e,this.remaining-=e,l(t.subarray(n,r))}readBinary(t){if(this.remaining<t)throw new Error(`ByteStream: readBinary: premature end - want ${t} bytes but have ${this.remaining}`);const n=this.uint8array,r=this.index;let e="";for(let s=0;s<t;s++)e+=String.fromCharCode(n[r+s]);return this.index+=t,this.remaining-=t,e}readInt8(){if(this.remaining<1)throw new Error(`ByteStream: readInt8: premature end - want 1 byte but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=f(n[t]);return this.index+=1,this.remaining-=1,r}readInt16(){if(this.remaining<2)throw new Error(`ByteStream: readInt16: premature end - want 2 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=g(n[t],n[t+1]);return this.index+=2,this.remaining-=2,r}readInt32(){if(this.remaining<4)throw new Error(`ByteStream: readInt32: premature end - want 4 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=m(n[t],n[t+1],n[t+2],n[t+3]);return this.index+=4,this.remaining-=4,r}readUint8(){if(this.remaining<1)throw new Error(`ByteStream: readUint8: premature end - want 1 byte but have ${this.remaining}`);const t=this.uint8array[this.index];return this.index+=1,this.remaining-=1,t}readUint16(){if(this.remaining<2)throw new Error(`ByteStream: readUint16: premature end - want 2 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=x(n[t],n[t+1]);return this.index+=2,this.remaining-=2,r}readUint32(){if(this.remaining<4)throw new Error(`ByteStream: readUint32: premature end - want 4 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=b(n[t],n[t+1],n[t+2],n[t+3]);return this.index+=4,this.remaining-=4,r}readFloat32(){if(this.remaining<4)throw new Error(`ByteStream: readFloat32: premature end - want 4 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=A(n[t],n[t+1],n[t+2],n[t+3]);return this.index+=4,this.remaining-=4,r}readFloat64(){if(this.remaining<8)throw new Error(`ByteStream: readFloat64: premature end - want 8 bytes but have ${this.remaining}`);const t=this.index,n=this.uint8array,r=$(n[t],n[t+1],n[t+2],n[t+3],n[t+4],n[t+5],n[t+6],n[t+7]);return this.index+=8,this.remaining-=8,r}readInt8Array(t){if(ArrayBuffer.isView(t)||(t=new Int8Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readInt8Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++)t[e]=f(r[n+e]);return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readInt16Array(t){if(ArrayBuffer.isView(t)||(t=new Int16Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readInt16Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*2;t[e]=g(r[i],r[i+1])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readInt32Array(t){if(ArrayBuffer.isView(t)||(t=new Int32Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readInt32Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;t[e]=m(r[i],r[i+1],r[i+2],r[i+3])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readUint8Array(t){if(ArrayBuffer.isView(t)||(t=new Uint8Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readUint8Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++)t[e]=r[n+e];return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readUint16Array(t){if(ArrayBuffer.isView(t)||(t=new Uint16Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readUint16Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*2;t[e]=x(r[i],r[i+1])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readUint32Array(t){if(ArrayBuffer.isView(t)||(t=new Uint32Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readUint32Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;t[e]=b(r[i],r[i+1],r[i+2],r[i+3])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readFloat32Array(t){if(ArrayBuffer.isView(t)||(t=new Float32Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readFloat32Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;t[e]=A(r[i],r[i+1],r[i+2],r[i+3])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}readFloat64Array(t){if(ArrayBuffer.isView(t)||(t=new Float64Array(t)),this.remaining<t.byteLength)throw new Error(`ByteStream: readFloat64Array: premature end - want ${t.byteLength} bytes but have ${this.remaining}`);const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*8;t[e]=$(r[i],r[i+1],r[i+2],r[i+3],r[i+4],r[i+5],r[i+6],r[i+7])}return this.index+=t.byteLength,this.remaining-=t.byteLength,t}write(t){const n=F(t);return this.writeUint8Array(n),n.length}writeNull(t){const n=this.write(t);return this.index++,this.remaining--,n+1}writeBinary(t){const n=this.index,r=this.uint8array,e=t.length;for(let s=0;s<e;s++)r[n+s]=t.charCodeAt(s);this.index+=e}writeInt8(t){this.uint8array[this.index]=B(t),this.index+=1}writeInt16(t){const n=this.index,r=this.uint8array;L(h,t),r[n]=h[0],r[n+1]=h[1],this.index+=2}writeInt32(t){const n=this.index,r=this.uint8array;w(h,t),r[n]=h[0],r[n+1]=h[1],r[n+2]=h[2],r[n+3]=h[3],this.index+=4}writeUint8(t){this.uint8array[this.index]=t,this.index+=1}writeUint16(t){const n=this.index,r=this.uint8array;U(h,t),r[n]=h[0],r[n+1]=h[1],this.index+=2}writeUint32(t){const n=this.index,r=this.uint8array;p(h,t),r[n]=h[0],r[n+1]=h[1],r[n+2]=h[2],r[n+3]=h[3],this.index+=4}writeFloat32(t){const n=this.index,r=this.uint8array;I(h,t),r[n]=h[0],r[n+1]=h[1],r[n+2]=h[2],r[n+3]=h[3],this.index+=4}writeFloat64(t){const n=this.index,r=this.uint8array;S(h,t),r[n]=h[0],r[n+1]=h[1],r[n+2]=h[2],r[n+3]=h[3],r[n+4]=h[4],r[n+5]=h[5],r[n+6]=h[6],r[n+7]=h[7],this.index+=8}writeInt8Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++)r[n+e]=B(t[e]);this.index+=t.byteLength}writeInt16Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*2;L(h,t[e]),r[i]=h[0],r[i+1]=h[1]}this.index+=t.byteLength}writeInt32Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;w(h,t[e]),r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2],r[i+3]=h[3]}this.index+=t.byteLength}writeUint8Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++)r[n+e]=t[e];this.index+=t.byteLength}writeUint16Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*2;U(h,t[e]),r[i]=h[0],r[i+1]=h[1]}this.index+=t.byteLength}writeUint32Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;p(h,t[e]),r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2],r[i+3]=h[3]}this.index+=t.byteLength}writeFloat32Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*4;I(h,t[e]),r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2],r[i+3]=h[3]}this.index+=t.byteLength}writeFloat64Array(t){const n=this.index,r=this.uint8array;for(let e=0,s=t.length;e<s;e++){const i=n+e*8;S(h,t[e]),r[i]=h[0],r[i+1]=h[1],r[i+2]=h[2],r[i+3]=h[3],r[i+4]=h[4],r[i+5]=h[5],r[i+6]=h[6],r[i+7]=h[7]}this.index+=t.byteLength}}class X{buffer;index=0;ident=0;indentSpaces=4;precision=1e6;constructor(t){this.buffer=t||""}clear(){this.buffer="",this.index=0,this.ident=0}readToken(){const t=this.buffer,n=t.length;let r=!1,e=!1,s="";for(;this.index<n;){const i=t[this.index++];if(r)i===`
`&&(r=!1);else if(e)if(i==="\\")s+=i+t[this.index++];else if(i===`
`)s+="\\n";else if(i==="\r")s+="\\r";else{if(i==='"')return s;s+=i}else if(i===" "||i===","||i==="	"||i===`
`||i===":"||i==="\r"){if(s.length)return s}else{if(i==="{"||i==="}")return s.length?(this.index--,s):i;if(i==="/"&&t[this.index]==="/"){if(s.length)return this.index--,s;r=!0}else if(i==='"'){if(s.length)return this.index--,s;e=!0}else s+=i}}}read(){const t=this.readToken();if(t===void 0)throw new Error("End of stream reached prematurely");return t}peek(){const t=this.index,n=this.read();return this.index=t,n}readInt(){return parseInt(this.read())}readFloat(){return parseFloat(this.read())}readVector(t){this.read();for(let n=0,r=t.length;n<r;n++)t[n]=this.readFloat();return this.read(),t}readVectorsBlock(t,n){this.read();for(let r=0,e=t.length;r<e;r+=n)this.readVector(t.subarray(r,r+n));return this.read(),t}readColor(t){return this.read(),t[2]=this.readFloat(),t[1]=this.readFloat(),t[0]=this.readFloat(),this.read(),t}*readBlock(){this.read();let t=this.read();for(;t!=="}";)yield t,t=this.read()}writeLine(t){this.buffer+=`${" ".repeat(this.ident*this.indentSpaces)}${t}
`}writeFlag(t){this.writeLine(`${t},`)}writeFlagAttrib(t,n){this.writeLine(`${t} ${n},`)}writeNumberAttrib(t,n){this.writeLine(`${t} ${this.floatDecimals(n)},`)}writeStringAttrib(t,n){this.writeLine(`${t} "${n}",`)}writeVectorAttrib(t,n){this.writeLine(`${t} { ${this.floatArrayDecimals(n)} },`)}writeColor(t,n){const r=this.floatDecimals(n[0]),e=this.floatDecimals(n[1]),s=this.floatDecimals(n[2]);this.writeLine(`${t} { ${s}, ${e}, ${r} },`)}writeVector(t){this.writeLine(`{ ${this.floatArrayDecimals(t)} },`)}writeVectorArrayBlock(t,n,r){this.startBlock(t,n.length/r);for(let e=0,s=n.length;e<s;e+=r)this.writeVector(n.subarray(e,e+r));this.endBlock()}startBlock(t,...n){n.length&&(t=`${t} ${n.join(" ")}`),this.writeLine(`${t} {`),this.ident+=1}startObjectBlock(t,n){this.writeLine(`${t} "${n.replace(/"/g,'\\"')}" {`),this.ident+=1}endBlock(){this.ident-=1,this.writeLine("}")}endBlockComma(){this.ident-=1,this.writeLine("},")}indent(){this.ident+=1}unindent(){this.ident-=1}floatDecimals(t){return`${Math.trunc(t*this.precision)/this.precision}`}floatArrayDecimals(t){if(t instanceof Float32Array){const n=[];for(let r=0,e=t.length;r<e;r++)n[r]=this.floatDecimals(t[r]);return n.join(", ")}else return t.join(", ")}}export{M as B,X as T,q as a,W as b,H as c,R as d,l as e,P as f,F as g,K as i,Q as n,J as s};
