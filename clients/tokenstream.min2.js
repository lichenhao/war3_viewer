import{d as u}from"./tokenstream.min.js";class o{buffer;index;constructor(i){this.buffer=i,this.index=0}read(){const i=this.buffer,n=i.length;let r=!1,l=!1,f=!1,t="";for(;this.index<n;){const e=i[this.index++];if(r)e===`
`&&(r=!1,this.index--);else if(l){if(e==="\\"?t+=e+i[this.index++]:e===`
`?t+="\\n":e==="\r"?t+="\\r":t+=e,e==='"')return t}else if(f){if(t+=e,e==="'")return t}else if(e===" "||e==="	"){if(t.length)return t}else if(e==="("||e===")"||e==="["||e==="]"||e==="="||e==="\r"||e===`
`||e===","||e==="!"||e==="-"||e==="<"||e===">"||e==="+"||e==="*"||e==="/"){if(t.length)return this.index--,t;{const s=i[this.index];if(e==="="&&s==="=")return this.index++,"==";if(e==="\r")return s===`
`&&this.index++,`
`;if(e==="!"&&s==="=")return this.index++,"!=";if(e==="/"&&s==="/"){if(t.length)return this.index--,t;r=!0}else return e}}else if(e==='"'){if(t.length)return this.index--,t;t+=e,l=!0}else if(e==="'"){if(t.length)return this.index--,t;t+=e,f=!0}else t+=e;if(this.index===n)return t}}peek(){const i=this.index,n=this.read();return this.index=i,n}readSafe(){const i=this.read();if(i===void 0)throw new Error("Premature end of stream reached");return i==="null"?"nil":i==="!="?"~=":i[0]==="'"?`${u(i.slice(1,i.indexOf("'",1)))}`:i==="break"||i==="do"||i==="end"||i==="for"||i==="goto"||i==="in"||i==="nil"||i==="repeat"||i==="until"||i==="while"?i+"_":i==="and"||i==="or"?" "+i+" ":i[0]==="$"?"0x"+i.slice(1):i}readUntil(i){let n="",r;for(;(r=this.readSafe())!==i;)n+=r;return n}}export{o as T};
