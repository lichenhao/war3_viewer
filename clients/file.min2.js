import{B as s}from"./tokenstream.min.js";class d{id="\0\0\0\0";chance=0;load(i){this.id=i.readBinary(4),this.chance=i.readInt32()}save(i){i.writeBinary(this.id),i.writeInt32(this.chance)}}class h{items=[];load(i){for(let t=0,e=i.readUint32();t<e;t++){const r=new d;r.load(i),this.items.push(r)}}save(i){i.writeUint32(this.items.length);for(const t of this.items)t.save(i)}getByteLength(){return 4+this.items.length*8}}class l{id="\0\0\0\0";variation=0;location=new Float32Array(3);angle=0;scale=new Float32Array([1,1,1]);skin="\0\0\0\0";flags=0;life=0;itemTable=-1;itemSets=[];editorId=0;u1=new Uint8Array(8);load(i,t,e){if(this.id=i.readBinary(4),this.variation=i.readInt32(),i.readFloat32Array(this.location),this.angle=i.readFloat32(),i.readFloat32Array(this.scale),e>131&&(this.skin=i.readBinary(4)),this.flags=i.readUint8(),this.life=i.readUint8(),t>7){this.itemTable=i.readUint32();for(let r=0,o=i.readUint32();r<o;r++){const n=new h;n.load(i),this.itemSets.push(n)}}this.editorId=i.readInt32()}save(i,t,e){if(i.writeBinary(this.id),i.writeInt32(this.variation),i.writeFloat32Array(this.location),i.writeFloat32(this.angle),i.writeFloat32Array(this.scale),e>131&&i.writeBinary(this.skin),i.writeUint8(this.flags),i.writeUint8(this.life),t>7){i.writeUint32(this.itemTable),i.writeUint32(this.itemSets.length);for(const r of this.itemSets)r.save(i)}i.writeInt32(this.editorId)}getByteLength(i,t){let e=42;if(t>131&&(e+=4),i>7){e+=8;for(const r of this.itemSets)e+=r.getByteLength()}return e}}class w{id="\0\0\0\0";u1=0;location=new Uint32Array(2);load(i,t){this.id=i.readBinary(4),this.u1=i.readUint32(),i.readUint32Array(this.location)}save(i,t){i.writeBinary(this.id),i.writeUint32(this.u1),i.writeUint32Array(this.location)}}class f{version=0;u1=new Uint8Array(4);doodads=[];u2=new Uint8Array(4);terrainDoodads=[];load(i,t){const e=new s(i);if(e.readBinary(4)!=="W3do")throw new Error("Not a valid war3map.doo buffer");this.version=e.readInt32(),e.readUint8Array(this.u1);for(let r=0,o=e.readInt32();r<o;r++){const n=new l;n.load(e,this.version,t),this.doodads.push(n)}e.readUint8Array(this.u2);for(let r=0,o=e.readInt32();r<o;r++){const n=new w;n.load(e,this.version),this.terrainDoodads.push(n)}}save(i){const t=new s(new ArrayBuffer(this.getByteLength(i)));t.writeBinary("W3do"),t.writeInt32(this.version),t.writeUint8Array(this.u1),t.writeUint32(this.doodads.length);for(const e of this.doodads)e.save(t,this.version,i);t.writeUint8Array(this.u2),t.writeUint32(this.terrainDoodads.length);for(const e of this.terrainDoodads)e.save(t,this.version);return t.uint8array}getByteLength(i){let t=24+this.terrainDoodads.length*16;for(const e of this.doodads)t+=e.getByteLength(this.version,i);return t}}export{f as W};
