import{e as Ln,a as Mt,n as Dt,c as A,B as R,T as Nn}from"./tokenstream.min.js";import{p as Cn}from"./math.min.js";class Ot{offset=0;compressedSize=0;normalSize=0;flags=0;load(i){this.offset=i[0],this.compressedSize=i[1],this.normalSize=i[2],this.flags=i[3]}save(i){i[0]=this.offset,i[1]=this.compressedSize,i[2]=this.normalSize,i[3]=this.flags}}const Rn=441536589,Ft=3283040112,Zt=0,$t=1,Pt=2,Mn=3,Ge=4294967294,Fi=4294967295,Ht=3968054179,Dn=256,nt=512,at=65536,Zi=131072,Kt=16777216,De=2147483648,On=1,Fn=2,Zn=8,$n=16,Pn=64,Hn=128;class Kn{c;entries;constructor(i){this.c=i,this.entries=[]}add(i){const e=new Ot;return e.normalSize=i.byteLength,this.entries.push(e),e}clear(){this.entries.length=0}addEmpties(i){for(let e=0;e<i;e++)this.entries.push(new Ot)}load(i){const e=i.byteLength/16,n=new Uint32Array(this.c.decryptBlock(i,Ht).buffer);let a=0;this.clear(),this.addEmpties(e);for(const r of this.entries)r.load(n.subarray(a,a+4)),a+=4}save(i){const e=new Uint32Array(this.entries.length*4);let n=0;for(const r of this.entries)r.save(e.subarray(n,n+4)),n+=4;const a=new Uint8Array(e.buffer);this.c.encryptBlock(a,Ht),i.set(a)}}const N=new Uint8Array(4),Oe=new Uint32Array(N.buffer);class Gn{cryptTable=new Uint32Array(1280);constructor(){let i=1048577,e=0,n=0;for(let a=0;a<256;a++)for(let r=a,s=0;s<5;s+=1,r+=256)i=(i*125+3)%2796203,e=(i&65535)<<16,i=(i*125+3)%2796203,n=i&65535,this.cryptTable[r]=e|n}hash(i,e){const n=this.cryptTable;let a=2146271213,r=4008636142;i=i.toUpperCase();for(let s=0;s<i.length;s++){const l=i.charCodeAt(s);a=n[(e<<8)+l]^a+r,r=l+a+r+(r<<5)+3}return a>>>0}decryptBlock(i,e){const n=this.cryptTable;let a=4008636142;const r=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);for(let s=0,l=i.byteLength>>>2;s<l;s++)a+=n[1024+(e&255)],N[0]=r[s*4],N[1]=r[s*4+1],N[2]=r[s*4+2],N[3]=r[s*4+3],Oe[0]^=e+a,e=(~e<<21)+286331153|e>>>11,a=Oe[0]+a+(a<<5)+3,r[s*4]=N[0],r[s*4+1]=N[1],r[s*4+2]=N[2],r[s*4+3]=N[3];return i}encryptBlock(i,e){const n=this.cryptTable;let a=4008636142;const r=new Uint8Array(i.buffer,i.byteOffset,i.byteLength);for(let s=0,l=i.byteLength>>>2;s<l;s++){a+=n[1024+(e&255)],N[0]=r[s*4],N[1]=r[s*4+1],N[2]=r[s*4+2],N[3]=r[s*4+3];const c=Oe[0];Oe[0]^=e+a,e=(~e<<21)+286331153|e>>>11,a=c+a+(a<<5)+3,r[s*4]=N[0],r[s*4+1]=N[1],r[s*4+2]=N[2],r[s*4+3]=N[3]}return i}computeFileKey(i,e){const n=i.lastIndexOf("\\"),a=i.substring(n+1);let r=this.hash(a,Mn);return e.flags&Zi&&(r=r+e.offset^e.normalSize),r}}const jn=4,Gt=0,jt=1,Yn=2;function ge(t){let i=t.length;for(;--i>=0;)t[i]=0}const Vn=0,$i=1,Xn=2,qn=3,Qn=258,zt=29,Ne=256,Ie=Ne+1+zt,de=30,Ut=19,Pi=2*Ie+1,ie=15,rt=16,Jn=7,Bt=256,Hi=16,Ki=17,Gi=18,yt=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Ke=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Wn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),ji=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ea=512,V=new Array((Ie+2)*2);ge(V);const xe=new Array(de*2);ge(xe);const Ae=new Array(ea);ge(Ae);const Se=new Array(Qn-qn+1);ge(Se);const Lt=new Array(zt);ge(Lt);const je=new Array(de);ge(je);function st(t,i,e,n,a){this.static_tree=t,this.extra_bits=i,this.extra_base=e,this.elems=n,this.max_length=a,this.has_stree=t&&t.length}let Yi,Vi,Xi;function lt(t,i){this.dyn_tree=t,this.max_code=0,this.stat_desc=i}const qi=t=>t<256?Ae[t]:Ae[256+(t>>>7)],Te=(t,i)=>{t.pending_buf[t.pending++]=i&255,t.pending_buf[t.pending++]=i>>>8&255},D=(t,i,e)=>{t.bi_valid>rt-e?(t.bi_buf|=i<<t.bi_valid&65535,Te(t,t.bi_buf),t.bi_buf=i>>rt-t.bi_valid,t.bi_valid+=e-rt):(t.bi_buf|=i<<t.bi_valid&65535,t.bi_valid+=e)},K=(t,i,e)=>{D(t,e[i*2],e[i*2+1])},Qi=(t,i)=>{let e=0;do e|=t&1,t>>>=1,e<<=1;while(--i>0);return e>>>1},ta=t=>{t.bi_valid===16?(Te(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},ia=(t,i)=>{const e=i.dyn_tree,n=i.max_code,a=i.stat_desc.static_tree,r=i.stat_desc.has_stree,s=i.stat_desc.extra_bits,l=i.stat_desc.extra_base,c=i.stat_desc.max_length;let o,h,g,d,f,_,T=0;for(d=0;d<=ie;d++)t.bl_count[d]=0;for(e[t.heap[t.heap_max]*2+1]=0,o=t.heap_max+1;o<Pi;o++)h=t.heap[o],d=e[e[h*2+1]*2+1]+1,d>c&&(d=c,T++),e[h*2+1]=d,!(h>n)&&(t.bl_count[d]++,f=0,h>=l&&(f=s[h-l]),_=e[h*2],t.opt_len+=_*(d+f),r&&(t.static_len+=_*(a[h*2+1]+f)));if(T!==0){do{for(d=c-1;t.bl_count[d]===0;)d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,T-=2}while(T>0);for(d=c;d!==0;d--)for(h=t.bl_count[d];h!==0;)g=t.heap[--o],!(g>n)&&(e[g*2+1]!==d&&(t.opt_len+=(d-e[g*2+1])*e[g*2],e[g*2+1]=d),h--)}},Ji=(t,i,e)=>{const n=new Array(ie+1);let a=0,r,s;for(r=1;r<=ie;r++)a=a+e[r-1]<<1,n[r]=a;for(s=0;s<=i;s++){let l=t[s*2+1];l!==0&&(t[s*2]=Qi(n[l]++,l))}},na=()=>{let t,i,e,n,a;const r=new Array(ie+1);for(e=0,n=0;n<zt-1;n++)for(Lt[n]=e,t=0;t<1<<yt[n];t++)Se[e++]=n;for(Se[e-1]=n,a=0,n=0;n<16;n++)for(je[n]=a,t=0;t<1<<Ke[n];t++)Ae[a++]=n;for(a>>=7;n<de;n++)for(je[n]=a<<7,t=0;t<1<<Ke[n]-7;t++)Ae[256+a++]=n;for(i=0;i<=ie;i++)r[i]=0;for(t=0;t<=143;)V[t*2+1]=8,t++,r[8]++;for(;t<=255;)V[t*2+1]=9,t++,r[9]++;for(;t<=279;)V[t*2+1]=7,t++,r[7]++;for(;t<=287;)V[t*2+1]=8,t++,r[8]++;for(Ji(V,Ie+1,r),t=0;t<de;t++)xe[t*2+1]=5,xe[t*2]=Qi(t,5);Yi=new st(V,yt,Ne+1,Ie,ie),Vi=new st(xe,Ke,0,de,ie),Xi=new st(new Array(0),Wn,0,Ut,Jn)},Wi=t=>{let i;for(i=0;i<Ie;i++)t.dyn_ltree[i*2]=0;for(i=0;i<de;i++)t.dyn_dtree[i*2]=0;for(i=0;i<Ut;i++)t.bl_tree[i*2]=0;t.dyn_ltree[Bt*2]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},en=t=>{t.bi_valid>8?Te(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Yt=(t,i,e,n)=>{const a=i*2,r=e*2;return t[a]<t[r]||t[a]===t[r]&&n[i]<=n[e]},ot=(t,i,e)=>{const n=t.heap[e];let a=e<<1;for(;a<=t.heap_len&&(a<t.heap_len&&Yt(i,t.heap[a+1],t.heap[a],t.depth)&&a++,!Yt(i,n,t.heap[a],t.depth));)t.heap[e]=t.heap[a],e=a,a<<=1;t.heap[e]=n},Vt=(t,i,e)=>{let n,a,r=0,s,l;if(t.sym_next!==0)do n=t.pending_buf[t.sym_buf+r++]&255,n+=(t.pending_buf[t.sym_buf+r++]&255)<<8,a=t.pending_buf[t.sym_buf+r++],n===0?K(t,a,i):(s=Se[a],K(t,s+Ne+1,i),l=yt[s],l!==0&&(a-=Lt[s],D(t,a,l)),n--,s=qi(n),K(t,s,e),l=Ke[s],l!==0&&(n-=je[s],D(t,n,l)));while(r<t.sym_next);K(t,Bt,i)},vt=(t,i)=>{const e=i.dyn_tree,n=i.stat_desc.static_tree,a=i.stat_desc.has_stree,r=i.stat_desc.elems;let s,l,c=-1,o;for(t.heap_len=0,t.heap_max=Pi,s=0;s<r;s++)e[s*2]!==0?(t.heap[++t.heap_len]=c=s,t.depth[s]=0):e[s*2+1]=0;for(;t.heap_len<2;)o=t.heap[++t.heap_len]=c<2?++c:0,e[o*2]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=n[o*2+1]);for(i.max_code=c,s=t.heap_len>>1;s>=1;s--)ot(t,e,s);o=r;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ot(t,e,1),l=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=l,e[o*2]=e[s*2]+e[l*2],t.depth[o]=(t.depth[s]>=t.depth[l]?t.depth[s]:t.depth[l])+1,e[s*2+1]=e[l*2+1]=o,t.heap[1]=o++,ot(t,e,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],ia(t,i),Ji(e,c,t.bl_count)},Xt=(t,i,e)=>{let n,a=-1,r,s=i[1],l=0,c=7,o=4;for(s===0&&(c=138,o=3),i[(e+1)*2+1]=65535,n=0;n<=e;n++)r=s,s=i[(n+1)*2+1],!(++l<c&&r===s)&&(l<o?t.bl_tree[r*2]+=l:r!==0?(r!==a&&t.bl_tree[r*2]++,t.bl_tree[Hi*2]++):l<=10?t.bl_tree[Ki*2]++:t.bl_tree[Gi*2]++,l=0,a=r,s===0?(c=138,o=3):r===s?(c=6,o=3):(c=7,o=4))},qt=(t,i,e)=>{let n,a=-1,r,s=i[1],l=0,c=7,o=4;for(s===0&&(c=138,o=3),n=0;n<=e;n++)if(r=s,s=i[(n+1)*2+1],!(++l<c&&r===s)){if(l<o)do K(t,r,t.bl_tree);while(--l!==0);else r!==0?(r!==a&&(K(t,r,t.bl_tree),l--),K(t,Hi,t.bl_tree),D(t,l-3,2)):l<=10?(K(t,Ki,t.bl_tree),D(t,l-3,3)):(K(t,Gi,t.bl_tree),D(t,l-11,7));l=0,a=r,s===0?(c=138,o=3):r===s?(c=6,o=3):(c=7,o=4)}},aa=t=>{let i;for(Xt(t,t.dyn_ltree,t.l_desc.max_code),Xt(t,t.dyn_dtree,t.d_desc.max_code),vt(t,t.bl_desc),i=Ut-1;i>=3&&t.bl_tree[ji[i]*2+1]===0;i--);return t.opt_len+=3*(i+1)+5+5+4,i},ra=(t,i,e,n)=>{let a;for(D(t,i-257,5),D(t,e-1,5),D(t,n-4,4),a=0;a<n;a++)D(t,t.bl_tree[ji[a]*2+1],3);qt(t,t.dyn_ltree,i-1),qt(t,t.dyn_dtree,e-1)},sa=t=>{let i=4093624447,e;for(e=0;e<=31;e++,i>>>=1)if(i&1&&t.dyn_ltree[e*2]!==0)return Gt;if(t.dyn_ltree[18]!==0||t.dyn_ltree[20]!==0||t.dyn_ltree[26]!==0)return jt;for(e=32;e<Ne;e++)if(t.dyn_ltree[e*2]!==0)return jt;return Gt};let Qt=!1;const la=t=>{Qt||(na(),Qt=!0),t.l_desc=new lt(t.dyn_ltree,Yi),t.d_desc=new lt(t.dyn_dtree,Vi),t.bl_desc=new lt(t.bl_tree,Xi),t.bi_buf=0,t.bi_valid=0,Wi(t)},tn=(t,i,e,n)=>{D(t,(Vn<<1)+(n?1:0),3),en(t),Te(t,e),Te(t,~e),e&&t.pending_buf.set(t.window.subarray(i,i+e),t.pending),t.pending+=e},oa=t=>{D(t,$i<<1,3),K(t,Bt,V),ta(t)},ha=(t,i,e,n)=>{let a,r,s=0;t.level>0?(t.strm.data_type===Yn&&(t.strm.data_type=sa(t)),vt(t,t.l_desc),vt(t,t.d_desc),s=aa(t),a=t.opt_len+3+7>>>3,r=t.static_len+3+7>>>3,r<=a&&(a=r)):a=r=e+5,e+4<=a&&i!==-1?tn(t,i,e,n):t.strategy===jn||r===a?(D(t,($i<<1)+(n?1:0),3),Vt(t,V,xe)):(D(t,(Xn<<1)+(n?1:0),3),ra(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),Vt(t,t.dyn_ltree,t.dyn_dtree)),Wi(t),n&&en(t)},fa=(t,i,e)=>(t.pending_buf[t.sym_buf+t.sym_next++]=i,t.pending_buf[t.sym_buf+t.sym_next++]=i>>8,t.pending_buf[t.sym_buf+t.sym_next++]=e,i===0?t.dyn_ltree[e*2]++:(t.matches++,i--,t.dyn_ltree[(Se[e]+Ne+1)*2]++,t.dyn_dtree[qi(i)*2]++),t.sym_next===t.sym_end);var ca=la,da=tn,ua=ha,_a=fa,ga=oa,wa={_tr_init:ca,_tr_stored_block:da,_tr_flush_block:ua,_tr_tally:_a,_tr_align:ga};const ba=(t,i,e,n)=>{let a=t&65535|0,r=t>>>16&65535|0,s=0;for(;e!==0;){s=e>2e3?2e3:e,e-=s;do a=a+i[n++]|0,r=r+a|0;while(--s);a%=65521,r%=65521}return a|r<<16|0};var ze=ba;const pa=()=>{let t,i=[];for(var e=0;e<256;e++){t=e;for(var n=0;n<8;n++)t=t&1?3988292384^t>>>1:t>>>1;i[e]=t}return i},ya=new Uint32Array(pa()),va=(t,i,e,n)=>{const a=ya,r=n+e;t^=-1;for(let s=n;s<r;s++)t=t>>>8^a[(t^i[s])&255];return t^-1};var L=va,re={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},qe={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ma,_tr_stored_block:mt,_tr_flush_block:xa,_tr_tally:J,_tr_align:ka}=wa,{Z_NO_FLUSH:W,Z_PARTIAL_FLUSH:Ea,Z_FULL_FLUSH:Ia,Z_FINISH:$,Z_BLOCK:Jt,Z_OK:C,Z_STREAM_END:Wt,Z_STREAM_ERROR:G,Z_DATA_ERROR:Aa,Z_BUF_ERROR:ht,Z_DEFAULT_COMPRESSION:Sa,Z_FILTERED:Ta,Z_HUFFMAN_ONLY:Fe,Z_RLE:za,Z_FIXED:Ua,Z_DEFAULT_STRATEGY:Ba,Z_UNKNOWN:La,Z_DEFLATED:Qe}=qe,Na=9,Ca=15,Ra=8,Ma=29,Da=256,xt=Da+1+Ma,Oa=30,Fa=19,Za=2*xt+1,$a=15,m=3,Q=258,j=Q+m+1,Pa=32,ue=42,Nt=57,kt=69,Et=73,It=91,At=103,ne=113,ye=666,M=1,we=2,se=3,be=4,Ha=3,ae=(t,i)=>(t.msg=re[i],i),ei=t=>t*2-(t>4?9:0),q=t=>{let i=t.length;for(;--i>=0;)t[i]=0},Ka=t=>{let i,e,n,a=t.w_size;i=t.hash_size,n=i;do e=t.head[--n],t.head[n]=e>=a?e-a:0;while(--i);i=a,n=i;do e=t.prev[--n],t.prev[n]=e>=a?e-a:0;while(--i)};let Ga=(t,i,e)=>(i<<t.hash_shift^e)&t.hash_mask,ee=Ga;const O=t=>{const i=t.state;let e=i.pending;e>t.avail_out&&(e=t.avail_out),e!==0&&(t.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+e),t.next_out),t.next_out+=e,i.pending_out+=e,t.total_out+=e,t.avail_out-=e,i.pending-=e,i.pending===0&&(i.pending_out=0))},F=(t,i)=>{xa(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,i),t.block_start=t.strstart,O(t.strm)},I=(t,i)=>{t.pending_buf[t.pending++]=i},pe=(t,i)=>{t.pending_buf[t.pending++]=i>>>8&255,t.pending_buf[t.pending++]=i&255},St=(t,i,e,n)=>{let a=t.avail_in;return a>n&&(a=n),a===0?0:(t.avail_in-=a,i.set(t.input.subarray(t.next_in,t.next_in+a),e),t.state.wrap===1?t.adler=ze(t.adler,i,a,e):t.state.wrap===2&&(t.adler=L(t.adler,i,a,e)),t.next_in+=a,t.total_in+=a,a)},nn=(t,i)=>{let e=t.max_chain_length,n=t.strstart,a,r,s=t.prev_length,l=t.nice_match;const c=t.strstart>t.w_size-j?t.strstart-(t.w_size-j):0,o=t.window,h=t.w_mask,g=t.prev,d=t.strstart+Q;let f=o[n+s-1],_=o[n+s];t.prev_length>=t.good_match&&(e>>=2),l>t.lookahead&&(l=t.lookahead);do if(a=i,!(o[a+s]!==_||o[a+s-1]!==f||o[a]!==o[n]||o[++a]!==o[n+1])){n+=2,a++;do;while(o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&o[++n]===o[++a]&&n<d);if(r=Q-(d-n),n=d-Q,r>s){if(t.match_start=i,s=r,r>=l)break;f=o[n+s-1],_=o[n+s]}}while((i=g[i&h])>c&&--e!==0);return s<=t.lookahead?s:t.lookahead},_e=t=>{const i=t.w_size;let e,n,a;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=i+(i-j)&&(t.window.set(t.window.subarray(i,i+i-n),0),t.match_start-=i,t.strstart-=i,t.block_start-=i,t.insert>t.strstart&&(t.insert=t.strstart),Ka(t),n+=i),t.strm.avail_in===0)break;if(e=St(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=e,t.lookahead+t.insert>=m)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=ee(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=ee(t,t.ins_h,t.window[a+m-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<m)););}while(t.lookahead<j&&t.strm.avail_in!==0)},an=(t,i)=>{let e=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,n,a,r,s=0,l=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r||(r=t.strm.avail_out-r,a=t.strstart-t.block_start,n>a+t.strm.avail_in&&(n=a+t.strm.avail_in),n>r&&(n=r),n<e&&(n===0&&i!==$||i===W||n!==a+t.strm.avail_in)))break;s=i===$&&n===a+t.strm.avail_in?1:0,mt(t,0,0,s),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,O(t.strm),a&&(a>n&&(a=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,n-=a),n&&(St(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(s===0);return l-=t.strm.avail_in,l&&(l>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=l&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-l,t.strm.next_in),t.strstart),t.strstart+=l,t.insert+=l>t.w_size-t.insert?t.w_size-t.insert:l),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?be:i!==W&&i!==$&&t.strm.avail_in===0&&t.strstart===t.block_start?we:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(St(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,e=r>t.w_size?t.w_size:r,a=t.strstart-t.block_start,(a>=e||(a||i===$)&&i!==W&&t.strm.avail_in===0&&a<=r)&&(n=a>r?r:a,s=i===$&&t.strm.avail_in===0&&n===a?1:0,mt(t,t.block_start,n,s),t.block_start+=n,O(t.strm)),s?se:M)},ft=(t,i)=>{let e,n;for(;;){if(t.lookahead<j){if(_e(t),t.lookahead<j&&i===W)return M;if(t.lookahead===0)break}if(e=0,t.lookahead>=m&&(t.ins_h=ee(t,t.ins_h,t.window[t.strstart+m-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),e!==0&&t.strstart-e<=t.w_size-j&&(t.match_length=nn(t,e)),t.match_length>=m)if(n=J(t,t.strstart-t.match_start,t.match_length-m),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=m){t.match_length--;do t.strstart++,t.ins_h=ee(t,t.ins_h,t.window[t.strstart+m-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ee(t,t.ins_h,t.window[t.strstart+1]);else n=J(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(F(t,!1),t.strm.avail_out===0))return M}return t.insert=t.strstart<m-1?t.strstart:m-1,i===$?(F(t,!0),t.strm.avail_out===0?se:be):t.sym_next&&(F(t,!1),t.strm.avail_out===0)?M:we},he=(t,i)=>{let e,n,a;for(;;){if(t.lookahead<j){if(_e(t),t.lookahead<j&&i===W)return M;if(t.lookahead===0)break}if(e=0,t.lookahead>=m&&(t.ins_h=ee(t,t.ins_h,t.window[t.strstart+m-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=m-1,e!==0&&t.prev_length<t.max_lazy_match&&t.strstart-e<=t.w_size-j&&(t.match_length=nn(t,e),t.match_length<=5&&(t.strategy===Ta||t.match_length===m&&t.strstart-t.match_start>4096)&&(t.match_length=m-1)),t.prev_length>=m&&t.match_length<=t.prev_length){a=t.strstart+t.lookahead-m,n=J(t,t.strstart-1-t.prev_match,t.prev_length-m),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=a&&(t.ins_h=ee(t,t.ins_h,t.window[t.strstart+m-1]),e=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=m-1,t.strstart++,n&&(F(t,!1),t.strm.avail_out===0))return M}else if(t.match_available){if(n=J(t,0,t.window[t.strstart-1]),n&&F(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return M}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=J(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<m-1?t.strstart:m-1,i===$?(F(t,!0),t.strm.avail_out===0?se:be):t.sym_next&&(F(t,!1),t.strm.avail_out===0)?M:we},ja=(t,i)=>{let e,n,a,r;const s=t.window;for(;;){if(t.lookahead<=Q){if(_e(t),t.lookahead<=Q&&i===W)return M;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=m&&t.strstart>0&&(a=t.strstart-1,n=s[a],n===s[++a]&&n===s[++a]&&n===s[++a])){r=t.strstart+Q;do;while(n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&n===s[++a]&&a<r);t.match_length=Q-(r-a),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=m?(e=J(t,1,t.match_length-m),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(e=J(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),e&&(F(t,!1),t.strm.avail_out===0))return M}return t.insert=0,i===$?(F(t,!0),t.strm.avail_out===0?se:be):t.sym_next&&(F(t,!1),t.strm.avail_out===0)?M:we},Ya=(t,i)=>{let e;for(;;){if(t.lookahead===0&&(_e(t),t.lookahead===0)){if(i===W)return M;break}if(t.match_length=0,e=J(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,e&&(F(t,!1),t.strm.avail_out===0))return M}return t.insert=0,i===$?(F(t,!0),t.strm.avail_out===0?se:be):t.sym_next&&(F(t,!1),t.strm.avail_out===0)?M:we};function H(t,i,e,n,a){this.good_length=t,this.max_lazy=i,this.nice_length=e,this.max_chain=n,this.func=a}const ve=[new H(0,0,0,0,an),new H(4,4,8,4,ft),new H(4,5,16,8,ft),new H(4,6,32,32,ft),new H(4,4,16,16,he),new H(8,16,32,32,he),new H(8,16,128,128,he),new H(8,32,128,256,he),new H(32,128,258,1024,he),new H(32,258,258,4096,he)],Va=t=>{t.window_size=2*t.w_size,q(t.head),t.max_lazy_match=ve[t.level].max_lazy,t.good_match=ve[t.level].good_length,t.nice_match=ve[t.level].nice_length,t.max_chain_length=ve[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=m-1,t.match_available=0,t.ins_h=0};function Xa(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Qe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Za*2),this.dyn_dtree=new Uint16Array((2*Oa+1)*2),this.bl_tree=new Uint16Array((2*Fa+1)*2),q(this.dyn_ltree),q(this.dyn_dtree),q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array($a+1),this.heap=new Uint16Array(2*xt+1),q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*xt+1),q(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ce=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.status!==ue&&i.status!==Nt&&i.status!==kt&&i.status!==Et&&i.status!==It&&i.status!==At&&i.status!==ne&&i.status!==ye?1:0},rn=t=>{if(Ce(t))return ae(t,G);t.total_in=t.total_out=0,t.data_type=La;const i=t.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?Nt:i.wrap?ue:ne,t.adler=i.wrap===2?0:1,i.last_flush=-2,ma(i),C},sn=t=>{const i=rn(t);return i===C&&Va(t.state),i},qa=(t,i)=>Ce(t)||t.state.wrap!==2?G:(t.state.gzhead=i,C),ln=(t,i,e,n,a,r)=>{if(!t)return G;let s=1;if(i===Sa&&(i=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),a<1||a>Na||e!==Qe||n<8||n>15||i<0||i>9||r<0||r>Ua||n===8&&s!==1)return ae(t,G);n===8&&(n=9);const l=new Xa;return t.state=l,l.strm=t,l.status=ue,l.wrap=s,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+m-1)/m),l.window=new Uint8Array(l.w_size*2),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=l.lit_bufsize*4,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=(l.lit_bufsize-1)*3,l.level=i,l.strategy=r,l.method=e,sn(t)},Qa=(t,i)=>ln(t,i,Qe,Ca,Ra,Ba),Ja=(t,i)=>{if(Ce(t)||i>Jt||i<0)return t?ae(t,G):G;const e=t.state;if(!t.output||t.avail_in!==0&&!t.input||e.status===ye&&i!==$)return ae(t,t.avail_out===0?ht:G);const n=e.last_flush;if(e.last_flush=i,e.pending!==0){if(O(t),t.avail_out===0)return e.last_flush=-1,C}else if(t.avail_in===0&&ei(i)<=ei(n)&&i!==$)return ae(t,ht);if(e.status===ye&&t.avail_in!==0)return ae(t,ht);if(e.status===ue&&e.wrap===0&&(e.status=ne),e.status===ue){let a=Qe+(e.w_bits-8<<4)<<8,r=-1;if(e.strategy>=Fe||e.level<2?r=0:e.level<6?r=1:e.level===6?r=2:r=3,a|=r<<6,e.strstart!==0&&(a|=Pa),a+=31-a%31,pe(e,a),e.strstart!==0&&(pe(e,t.adler>>>16),pe(e,t.adler&65535)),t.adler=1,e.status=ne,O(t),e.pending!==0)return e.last_flush=-1,C}if(e.status===Nt){if(t.adler=0,I(e,31),I(e,139),I(e,8),e.gzhead)I(e,(e.gzhead.text?1:0)+(e.gzhead.hcrc?2:0)+(e.gzhead.extra?4:0)+(e.gzhead.name?8:0)+(e.gzhead.comment?16:0)),I(e,e.gzhead.time&255),I(e,e.gzhead.time>>8&255),I(e,e.gzhead.time>>16&255),I(e,e.gzhead.time>>24&255),I(e,e.level===9?2:e.strategy>=Fe||e.level<2?4:0),I(e,e.gzhead.os&255),e.gzhead.extra&&e.gzhead.extra.length&&(I(e,e.gzhead.extra.length&255),I(e,e.gzhead.extra.length>>8&255)),e.gzhead.hcrc&&(t.adler=L(t.adler,e.pending_buf,e.pending,0)),e.gzindex=0,e.status=kt;else if(I(e,0),I(e,0),I(e,0),I(e,0),I(e,0),I(e,e.level===9?2:e.strategy>=Fe||e.level<2?4:0),I(e,Ha),e.status=ne,O(t),e.pending!==0)return e.last_flush=-1,C}if(e.status===kt){if(e.gzhead.extra){let a=e.pending,r=(e.gzhead.extra.length&65535)-e.gzindex;for(;e.pending+r>e.pending_buf_size;){let l=e.pending_buf_size-e.pending;if(e.pending_buf.set(e.gzhead.extra.subarray(e.gzindex,e.gzindex+l),e.pending),e.pending=e.pending_buf_size,e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex+=l,O(t),e.pending!==0)return e.last_flush=-1,C;a=0,r-=l}let s=new Uint8Array(e.gzhead.extra);e.pending_buf.set(s.subarray(e.gzindex,e.gzindex+r),e.pending),e.pending+=r,e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=Et}if(e.status===Et){if(e.gzhead.name){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a)),O(t),e.pending!==0)return e.last_flush=-1,C;a=0}e.gzindex<e.gzhead.name.length?r=e.gzhead.name.charCodeAt(e.gzindex++)&255:r=0,I(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a)),e.gzindex=0}e.status=It}if(e.status===It){if(e.gzhead.comment){let a=e.pending,r;do{if(e.pending===e.pending_buf_size){if(e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a)),O(t),e.pending!==0)return e.last_flush=-1,C;a=0}e.gzindex<e.gzhead.comment.length?r=e.gzhead.comment.charCodeAt(e.gzindex++)&255:r=0,I(e,r)}while(r!==0);e.gzhead.hcrc&&e.pending>a&&(t.adler=L(t.adler,e.pending_buf,e.pending-a,a))}e.status=At}if(e.status===At){if(e.gzhead.hcrc){if(e.pending+2>e.pending_buf_size&&(O(t),e.pending!==0))return e.last_flush=-1,C;I(e,t.adler&255),I(e,t.adler>>8&255),t.adler=0}if(e.status=ne,O(t),e.pending!==0)return e.last_flush=-1,C}if(t.avail_in!==0||e.lookahead!==0||i!==W&&e.status!==ye){let a=e.level===0?an(e,i):e.strategy===Fe?Ya(e,i):e.strategy===za?ja(e,i):ve[e.level].func(e,i);if((a===se||a===be)&&(e.status=ye),a===M||a===se)return t.avail_out===0&&(e.last_flush=-1),C;if(a===we&&(i===Ea?ka(e):i!==Jt&&(mt(e,0,0,!1),i===Ia&&(q(e.head),e.lookahead===0&&(e.strstart=0,e.block_start=0,e.insert=0))),O(t),t.avail_out===0))return e.last_flush=-1,C}return i!==$?C:e.wrap<=0?Wt:(e.wrap===2?(I(e,t.adler&255),I(e,t.adler>>8&255),I(e,t.adler>>16&255),I(e,t.adler>>24&255),I(e,t.total_in&255),I(e,t.total_in>>8&255),I(e,t.total_in>>16&255),I(e,t.total_in>>24&255)):(pe(e,t.adler>>>16),pe(e,t.adler&65535)),O(t),e.wrap>0&&(e.wrap=-e.wrap),e.pending!==0?C:Wt)},Wa=t=>{if(Ce(t))return G;const i=t.state.status;return t.state=null,i===ne?ae(t,Aa):C},er=(t,i)=>{let e=i.length;if(Ce(t))return G;const n=t.state,a=n.wrap;if(a===2||a===1&&n.status!==ue||n.lookahead)return G;if(a===1&&(t.adler=ze(t.adler,i,e,0)),n.wrap=0,e>=n.w_size){a===0&&(q(n.head),n.strstart=0,n.block_start=0,n.insert=0);let c=new Uint8Array(n.w_size);c.set(i.subarray(e-n.w_size,e),0),i=c,e=n.w_size}const r=t.avail_in,s=t.next_in,l=t.input;for(t.avail_in=e,t.next_in=0,t.input=i,_e(n);n.lookahead>=m;){let c=n.strstart,o=n.lookahead-(m-1);do n.ins_h=ee(n,n.ins_h,n.window[c+m-1]),n.prev[c&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=c,c++;while(--o);n.strstart=c,n.lookahead=m-1,_e(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=m-1,n.match_available=0,t.next_in=s,t.input=l,t.avail_in=r,n.wrap=a,C};var tr=Qa,ir=ln,nr=sn,ar=rn,rr=qa,sr=Ja,lr=Wa,or=er,hr="pako deflate (from Nodeca project)",ke={deflateInit:tr,deflateInit2:ir,deflateReset:nr,deflateResetKeep:ar,deflateSetHeader:rr,deflate:sr,deflateEnd:lr,deflateSetDictionary:or,deflateInfo:hr};const fr=(t,i)=>Object.prototype.hasOwnProperty.call(t,i);var cr=function(t){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const e=i.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const n in e)fr(e,n)&&(t[n]=e[n])}}return t},dr=t=>{let i=0;for(let n=0,a=t.length;n<a;n++)i+=t[n].length;const e=new Uint8Array(i);for(let n=0,a=0,r=t.length;n<r;n++){let s=t[n];e.set(s,a),a+=s.length}return e},Je={assign:cr,flattenChunks:dr};let on=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{on=!1}const Ue=new Uint8Array(256);for(let t=0;t<256;t++)Ue[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ue[254]=Ue[254]=1;var ur=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let i,e,n,a,r,s=t.length,l=0;for(a=0;a<s;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<s&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),l+=e<128?1:e<2048?2:e<65536?3:4;for(i=new Uint8Array(l),r=0,a=0;r<l;a++)e=t.charCodeAt(a),(e&64512)===55296&&a+1<s&&(n=t.charCodeAt(a+1),(n&64512)===56320&&(e=65536+(e-55296<<10)+(n-56320),a++)),e<128?i[r++]=e:e<2048?(i[r++]=192|e>>>6,i[r++]=128|e&63):e<65536?(i[r++]=224|e>>>12,i[r++]=128|e>>>6&63,i[r++]=128|e&63):(i[r++]=240|e>>>18,i[r++]=128|e>>>12&63,i[r++]=128|e>>>6&63,i[r++]=128|e&63);return i};const _r=(t,i)=>{if(i<65534&&t.subarray&&on)return String.fromCharCode.apply(null,t.length===i?t:t.subarray(0,i));let e="";for(let n=0;n<i;n++)e+=String.fromCharCode(t[n]);return e};var gr=(t,i)=>{const e=i||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,i));let n,a;const r=new Array(e*2);for(a=0,n=0;n<e;){let s=t[n++];if(s<128){r[a++]=s;continue}let l=Ue[s];if(l>4){r[a++]=65533,n+=l-1;continue}for(s&=l===2?31:l===3?15:7;l>1&&n<e;)s=s<<6|t[n++]&63,l--;if(l>1){r[a++]=65533;continue}s<65536?r[a++]=s:(s-=65536,r[a++]=55296|s>>10&1023,r[a++]=56320|s&1023)}return _r(r,a)},wr=(t,i)=>{i=i||t.length,i>t.length&&(i=t.length);let e=i-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?i:e+Ue[t[e]]>i?e:i},Be={string2buf:ur,buf2string:gr,utf8border:wr};function br(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var hn=br;const fn=Object.prototype.toString,{Z_NO_FLUSH:pr,Z_SYNC_FLUSH:yr,Z_FULL_FLUSH:vr,Z_FINISH:mr,Z_OK:Ye,Z_STREAM_END:xr,Z_DEFAULT_COMPRESSION:kr,Z_DEFAULT_STRATEGY:Er,Z_DEFLATED:Ir}=qe;function We(t){this.options=Je.assign({level:kr,method:Ir,chunkSize:16384,windowBits:15,memLevel:8,strategy:Er},t||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hn,this.strm.avail_out=0;let e=ke.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(e!==Ye)throw new Error(re[e]);if(i.header&&ke.deflateSetHeader(this.strm,i.header),i.dictionary){let n;if(typeof i.dictionary=="string"?n=Be.string2buf(i.dictionary):fn.call(i.dictionary)==="[object ArrayBuffer]"?n=new Uint8Array(i.dictionary):n=i.dictionary,e=ke.deflateSetDictionary(this.strm,n),e!==Ye)throw new Error(re[e]);this._dict_set=!0}}We.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize;let a,r;if(this.ended)return!1;for(i===~~i?r=i:r=i===!0?mr:pr,typeof t=="string"?e.input=Be.string2buf(t):fn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){if(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),(r===yr||r===vr)&&e.avail_out<=6){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(a=ke.deflate(e,r),a===xr)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),a=ke.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===Ye;if(e.avail_out===0){this.onData(e.output);continue}if(r>0&&e.next_out>0){this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;continue}if(e.avail_in===0)break}return!0};We.prototype.onData=function(t){this.chunks.push(t)};We.prototype.onEnd=function(t){t===Ye&&(this.result=Je.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Ar(t,i){const e=new We(i);if(e.push(t,!0),e.err)throw e.msg||re[e.err];return e.result}var Sr=Ar,Tr={deflate:Sr};const Ze=16209,zr=16191;var Ur=function(i,e){let n,a,r,s,l,c,o,h,g,d,f,_,T,x,p,S,y,u,E,B,w,z,k,b;const v=i.state;n=i.next_in,k=i.input,a=n+(i.avail_in-5),r=i.next_out,b=i.output,s=r-(e-i.avail_out),l=r+(i.avail_out-257),c=v.dmax,o=v.wsize,h=v.whave,g=v.wnext,d=v.window,f=v.hold,_=v.bits,T=v.lencode,x=v.distcode,p=(1<<v.lenbits)-1,S=(1<<v.distbits)-1;e:do{_<15&&(f+=k[n++]<<_,_+=8,f+=k[n++]<<_,_+=8),y=T[f&p];t:for(;;){if(u=y>>>24,f>>>=u,_-=u,u=y>>>16&255,u===0)b[r++]=y&65535;else if(u&16){E=y&65535,u&=15,u&&(_<u&&(f+=k[n++]<<_,_+=8),E+=f&(1<<u)-1,f>>>=u,_-=u),_<15&&(f+=k[n++]<<_,_+=8,f+=k[n++]<<_,_+=8),y=x[f&S];i:for(;;){if(u=y>>>24,f>>>=u,_-=u,u=y>>>16&255,u&16){if(B=y&65535,u&=15,_<u&&(f+=k[n++]<<_,_+=8,_<u&&(f+=k[n++]<<_,_+=8)),B+=f&(1<<u)-1,B>c){i.msg="invalid distance too far back",v.mode=Ze;break e}if(f>>>=u,_-=u,u=r-s,B>u){if(u=B-u,u>h&&v.sane){i.msg="invalid distance too far back",v.mode=Ze;break e}if(w=0,z=d,g===0){if(w+=o-u,u<E){E-=u;do b[r++]=d[w++];while(--u);w=r-B,z=b}}else if(g<u){if(w+=o+g-u,u-=g,u<E){E-=u;do b[r++]=d[w++];while(--u);if(w=0,g<E){u=g,E-=u;do b[r++]=d[w++];while(--u);w=r-B,z=b}}}else if(w+=g-u,u<E){E-=u;do b[r++]=d[w++];while(--u);w=r-B,z=b}for(;E>2;)b[r++]=z[w++],b[r++]=z[w++],b[r++]=z[w++],E-=3;E&&(b[r++]=z[w++],E>1&&(b[r++]=z[w++]))}else{w=r-B;do b[r++]=b[w++],b[r++]=b[w++],b[r++]=b[w++],E-=3;while(E>2);E&&(b[r++]=b[w++],E>1&&(b[r++]=b[w++]))}}else if((u&64)===0){y=x[(y&65535)+(f&(1<<u)-1)];continue i}else{i.msg="invalid distance code",v.mode=Ze;break e}break}}else if((u&64)===0){y=T[(y&65535)+(f&(1<<u)-1)];continue t}else if(u&32){v.mode=zr;break e}else{i.msg="invalid literal/length code",v.mode=Ze;break e}break}}while(n<a&&r<l);E=_>>3,n-=E,_-=E<<3,f&=(1<<_)-1,i.next_in=n,i.next_out=r,i.avail_in=n<a?5+(a-n):5-(n-a),i.avail_out=r<l?257+(l-r):257-(r-l),v.hold=f,v.bits=_};const fe=15,ti=852,ii=592,ni=0,ct=1,ai=2,Br=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Lr=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Nr=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Cr=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Rr=(t,i,e,n,a,r,s,l)=>{const c=l.bits;let o=0,h=0,g=0,d=0,f=0,_=0,T=0,x=0,p=0,S=0,y,u,E,B,w,z=null,k;const b=new Uint16Array(fe+1),v=new Uint16Array(fe+1);let te=null,Rt,Re,Me;for(o=0;o<=fe;o++)b[o]=0;for(h=0;h<n;h++)b[i[e+h]]++;for(f=c,d=fe;d>=1&&b[d]===0;d--);if(f>d&&(f=d),d===0)return a[r++]=1<<24|64<<16|0,a[r++]=1<<24|64<<16|0,l.bits=1,0;for(g=1;g<d&&b[g]===0;g++);for(f<g&&(f=g),x=1,o=1;o<=fe;o++)if(x<<=1,x-=b[o],x<0)return-1;if(x>0&&(t===ni||d!==1))return-1;for(v[1]=0,o=1;o<fe;o++)v[o+1]=v[o]+b[o];for(h=0;h<n;h++)i[e+h]!==0&&(s[v[i[e+h]]++]=h);if(t===ni?(z=te=s,k=20):t===ct?(z=Br,te=Lr,k=257):(z=Nr,te=Cr,k=0),S=0,h=0,o=g,w=r,_=f,T=0,E=-1,p=1<<f,B=p-1,t===ct&&p>ti||t===ai&&p>ii)return 1;for(;;){Rt=o-T,s[h]+1<k?(Re=0,Me=s[h]):s[h]>=k?(Re=te[s[h]-k],Me=z[s[h]-k]):(Re=96,Me=0),y=1<<o-T,u=1<<_,g=u;do u-=y,a[w+(S>>T)+u]=Rt<<24|Re<<16|Me|0;while(u!==0);for(y=1<<o-1;S&y;)y>>=1;if(y!==0?(S&=y-1,S+=y):S=0,h++,--b[o]===0){if(o===d)break;o=i[e+s[h]]}if(o>f&&(S&B)!==E){for(T===0&&(T=f),w+=g,_=o-T,x=1<<_;_+T<d&&(x-=b[_+T],!(x<=0));)_++,x<<=1;if(p+=1<<_,t===ct&&p>ti||t===ai&&p>ii)return 1;E=S&B,a[E]=f<<24|_<<16|w-r|0}}return S!==0&&(a[w+S]=o-T<<24|64<<16|0),l.bits=f,0};var Ee=Rr;const Mr=0,cn=1,dn=2,{Z_FINISH:ri,Z_BLOCK:Dr,Z_TREES:$e,Z_OK:le,Z_STREAM_END:Or,Z_NEED_DICT:Fr,Z_STREAM_ERROR:P,Z_DATA_ERROR:un,Z_MEM_ERROR:_n,Z_BUF_ERROR:Zr,Z_DEFLATED:si}=qe,et=16180,li=16181,oi=16182,hi=16183,fi=16184,ci=16185,di=16186,ui=16187,_i=16188,gi=16189,Ve=16190,Y=16191,dt=16192,wi=16193,ut=16194,bi=16195,pi=16196,yi=16197,vi=16198,Pe=16199,He=16200,mi=16201,xi=16202,ki=16203,Ei=16204,Ii=16205,_t=16206,Ai=16207,Si=16208,U=16209,gn=16210,wn=16211,$r=852,Pr=592,Hr=15,Kr=Hr,Ti=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function Gr(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const oe=t=>{if(!t)return 1;const i=t.state;return!i||i.strm!==t||i.mode<et||i.mode>wn?1:0},bn=t=>{if(oe(t))return P;const i=t.state;return t.total_in=t.total_out=i.total=0,t.msg="",i.wrap&&(t.adler=i.wrap&1),i.mode=et,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array($r),i.distcode=i.distdyn=new Int32Array(Pr),i.sane=1,i.back=-1,le},pn=t=>{if(oe(t))return P;const i=t.state;return i.wsize=0,i.whave=0,i.wnext=0,bn(t)},yn=(t,i)=>{let e;if(oe(t))return P;const n=t.state;return i<0?(e=0,i=-i):(e=(i>>4)+5,i<48&&(i&=15)),i&&(i<8||i>15)?P:(n.window!==null&&n.wbits!==i&&(n.window=null),n.wrap=e,n.wbits=i,pn(t))},vn=(t,i)=>{if(!t)return P;const e=new Gr;t.state=e,e.strm=t,e.window=null,e.mode=et;const n=yn(t,i);return n!==le&&(t.state=null),n},jr=t=>vn(t,Kr);let zi=!0,gt,wt;const Yr=t=>{if(zi){gt=new Int32Array(512),wt=new Int32Array(32);let i=0;for(;i<144;)t.lens[i++]=8;for(;i<256;)t.lens[i++]=9;for(;i<280;)t.lens[i++]=7;for(;i<288;)t.lens[i++]=8;for(Ee(cn,t.lens,0,288,gt,0,t.work,{bits:9}),i=0;i<32;)t.lens[i++]=5;Ee(dn,t.lens,0,32,wt,0,t.work,{bits:5}),zi=!1}t.lencode=gt,t.lenbits=9,t.distcode=wt,t.distbits=5},mn=(t,i,e,n)=>{let a;const r=t.state;return r.window===null&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),n>=r.wsize?(r.window.set(i.subarray(e-r.wsize,e),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>n&&(a=n),r.window.set(i.subarray(e-n,e-n+a),r.wnext),n-=a,n?(r.window.set(i.subarray(e-n,e),0),r.wnext=n,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},Vr=(t,i)=>{let e,n,a,r,s,l,c,o,h,g,d,f,_,T,x=0,p,S,y,u,E,B,w,z;const k=new Uint8Array(4);let b,v;const te=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(oe(t)||!t.output||!t.input&&t.avail_in!==0)return P;e=t.state,e.mode===Y&&(e.mode=dt),s=t.next_out,a=t.output,c=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,o=e.hold,h=e.bits,g=l,d=c,z=le;e:for(;;)switch(e.mode){case et:if(e.wrap===0){e.mode=dt;break}for(;h<16;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(e.wrap&2&&o===35615){e.wbits===0&&(e.wbits=15),e.check=0,k[0]=o&255,k[1]=o>>>8&255,e.check=L(e.check,k,2,0),o=0,h=0,e.mode=li;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((o&255)<<8)+(o>>8))%31){t.msg="incorrect header check",e.mode=U;break}if((o&15)!==si){t.msg="unknown compression method",e.mode=U;break}if(o>>>=4,h-=4,w=(o&15)+8,e.wbits===0&&(e.wbits=w),w>15||w>e.wbits){t.msg="invalid window size",e.mode=U;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=o&512?gi:Y,o=0,h=0;break;case li:for(;h<16;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(e.flags=o,(e.flags&255)!==si){t.msg="unknown compression method",e.mode=U;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=U;break}e.head&&(e.head.text=o>>8&1),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=L(e.check,k,2,0)),o=0,h=0,e.mode=oi;case oi:for(;h<32;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.head&&(e.head.time=o),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,k[2]=o>>>16&255,k[3]=o>>>24&255,e.check=L(e.check,k,4,0)),o=0,h=0,e.mode=hi;case hi:for(;h<16;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.head&&(e.head.xflags=o&255,e.head.os=o>>8),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=L(e.check,k,2,0)),o=0,h=0,e.mode=fi;case fi:if(e.flags&1024){for(;h<16;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.length=o,e.head&&(e.head.extra_len=o),e.flags&512&&e.wrap&4&&(k[0]=o&255,k[1]=o>>>8&255,e.check=L(e.check,k,2,0)),o=0,h=0}else e.head&&(e.head.extra=null);e.mode=ci;case ci:if(e.flags&1024&&(f=e.length,f>l&&(f=l),f&&(e.head&&(w=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(n.subarray(r,r+f),w)),e.flags&512&&e.wrap&4&&(e.check=L(e.check,n,f,r)),l-=f,r+=f,e.length-=f),e.length))break e;e.length=0,e.mode=di;case di:if(e.flags&2048){if(l===0)break e;f=0;do w=n[r+f++],e.head&&w&&e.length<65536&&(e.head.name+=String.fromCharCode(w));while(w&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=L(e.check,n,f,r)),l-=f,r+=f,w)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=ui;case ui:if(e.flags&4096){if(l===0)break e;f=0;do w=n[r+f++],e.head&&w&&e.length<65536&&(e.head.comment+=String.fromCharCode(w));while(w&&f<l);if(e.flags&512&&e.wrap&4&&(e.check=L(e.check,n,f,r)),l-=f,r+=f,w)break e}else e.head&&(e.head.comment=null);e.mode=_i;case _i:if(e.flags&512){for(;h<16;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(e.wrap&4&&o!==(e.check&65535)){t.msg="header crc mismatch",e.mode=U;break}o=0,h=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=Y;break;case gi:for(;h<32;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}t.adler=e.check=Ti(o),o=0,h=0,e.mode=Ve;case Ve:if(e.havedict===0)return t.next_out=s,t.avail_out=c,t.next_in=r,t.avail_in=l,e.hold=o,e.bits=h,Fr;t.adler=e.check=1,e.mode=Y;case Y:if(i===Dr||i===$e)break e;case dt:if(e.last){o>>>=h&7,h-=h&7,e.mode=_t;break}for(;h<3;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}switch(e.last=o&1,o>>>=1,h-=1,o&3){case 0:e.mode=wi;break;case 1:if(Yr(e),e.mode=Pe,i===$e){o>>>=2,h-=2;break e}break;case 2:e.mode=pi;break;case 3:t.msg="invalid block type",e.mode=U}o>>>=2,h-=2;break;case wi:for(o>>>=h&7,h-=h&7;h<32;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if((o&65535)!==(o>>>16^65535)){t.msg="invalid stored block lengths",e.mode=U;break}if(e.length=o&65535,o=0,h=0,e.mode=ut,i===$e)break e;case ut:e.mode=bi;case bi:if(f=e.length,f){if(f>l&&(f=l),f>c&&(f=c),f===0)break e;a.set(n.subarray(r,r+f),s),l-=f,r+=f,c-=f,s+=f,e.length-=f;break}e.mode=Y;break;case pi:for(;h<14;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(e.nlen=(o&31)+257,o>>>=5,h-=5,e.ndist=(o&31)+1,o>>>=5,h-=5,e.ncode=(o&15)+4,o>>>=4,h-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=U;break}e.have=0,e.mode=yi;case yi:for(;e.have<e.ncode;){for(;h<3;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.lens[te[e.have++]]=o&7,o>>>=3,h-=3}for(;e.have<19;)e.lens[te[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,b={bits:e.lenbits},z=Ee(Mr,e.lens,0,19,e.lencode,0,e.work,b),e.lenbits=b.bits,z){t.msg="invalid code lengths set",e.mode=U;break}e.have=0,e.mode=vi;case vi:for(;e.have<e.nlen+e.ndist;){for(;x=e.lencode[o&(1<<e.lenbits)-1],p=x>>>24,S=x>>>16&255,y=x&65535,!(p<=h);){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(y<16)o>>>=p,h-=p,e.lens[e.have++]=y;else{if(y===16){for(v=p+2;h<v;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(o>>>=p,h-=p,e.have===0){t.msg="invalid bit length repeat",e.mode=U;break}w=e.lens[e.have-1],f=3+(o&3),o>>>=2,h-=2}else if(y===17){for(v=p+3;h<v;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}o>>>=p,h-=p,w=0,f=3+(o&7),o>>>=3,h-=3}else{for(v=p+7;h<v;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}o>>>=p,h-=p,w=0,f=11+(o&127),o>>>=7,h-=7}if(e.have+f>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=U;break}for(;f--;)e.lens[e.have++]=w}}if(e.mode===U)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=U;break}if(e.lenbits=9,b={bits:e.lenbits},z=Ee(cn,e.lens,0,e.nlen,e.lencode,0,e.work,b),e.lenbits=b.bits,z){t.msg="invalid literal/lengths set",e.mode=U;break}if(e.distbits=6,e.distcode=e.distdyn,b={bits:e.distbits},z=Ee(dn,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,b),e.distbits=b.bits,z){t.msg="invalid distances set",e.mode=U;break}if(e.mode=Pe,i===$e)break e;case Pe:e.mode=He;case He:if(l>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=r,t.avail_in=l,e.hold=o,e.bits=h,Ur(t,d),s=t.next_out,a=t.output,c=t.avail_out,r=t.next_in,n=t.input,l=t.avail_in,o=e.hold,h=e.bits,e.mode===Y&&(e.back=-1);break}for(e.back=0;x=e.lencode[o&(1<<e.lenbits)-1],p=x>>>24,S=x>>>16&255,y=x&65535,!(p<=h);){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(S&&(S&240)===0){for(u=p,E=S,B=y;x=e.lencode[B+((o&(1<<u+E)-1)>>u)],p=x>>>24,S=x>>>16&255,y=x&65535,!(u+p<=h);){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}o>>>=u,h-=u,e.back+=u}if(o>>>=p,h-=p,e.back+=p,e.length=y,S===0){e.mode=Ii;break}if(S&32){e.back=-1,e.mode=Y;break}if(S&64){t.msg="invalid literal/length code",e.mode=U;break}e.extra=S&15,e.mode=mi;case mi:if(e.extra){for(v=e.extra;h<v;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.length+=o&(1<<e.extra)-1,o>>>=e.extra,h-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=xi;case xi:for(;x=e.distcode[o&(1<<e.distbits)-1],p=x>>>24,S=x>>>16&255,y=x&65535,!(p<=h);){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if((S&240)===0){for(u=p,E=S,B=y;x=e.distcode[B+((o&(1<<u+E)-1)>>u)],p=x>>>24,S=x>>>16&255,y=x&65535,!(u+p<=h);){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}o>>>=u,h-=u,e.back+=u}if(o>>>=p,h-=p,e.back+=p,S&64){t.msg="invalid distance code",e.mode=U;break}e.offset=y,e.extra=S&15,e.mode=ki;case ki:if(e.extra){for(v=e.extra;h<v;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}e.offset+=o&(1<<e.extra)-1,o>>>=e.extra,h-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=U;break}e.mode=Ei;case Ei:if(c===0)break e;if(f=d-c,e.offset>f){if(f=e.offset-f,f>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=U;break}f>e.wnext?(f-=e.wnext,_=e.wsize-f):_=e.wnext-f,f>e.length&&(f=e.length),T=e.window}else T=a,_=s-e.offset,f=e.length;f>c&&(f=c),c-=f,e.length-=f;do a[s++]=T[_++];while(--f);e.length===0&&(e.mode=He);break;case Ii:if(c===0)break e;a[s++]=e.length,c--,e.mode=He;break;case _t:if(e.wrap){for(;h<32;){if(l===0)break e;l--,o|=n[r++]<<h,h+=8}if(d-=c,t.total_out+=d,e.total+=d,e.wrap&4&&d&&(t.adler=e.check=e.flags?L(e.check,a,d,s-d):ze(e.check,a,d,s-d)),d=c,e.wrap&4&&(e.flags?o:Ti(o))!==e.check){t.msg="incorrect data check",e.mode=U;break}o=0,h=0}e.mode=Ai;case Ai:if(e.wrap&&e.flags){for(;h<32;){if(l===0)break e;l--,o+=n[r++]<<h,h+=8}if(e.wrap&4&&o!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=U;break}o=0,h=0}e.mode=Si;case Si:z=Or;break e;case U:z=un;break e;case gn:return _n;case wn:default:return P}return t.next_out=s,t.avail_out=c,t.next_in=r,t.avail_in=l,e.hold=o,e.bits=h,(e.wsize||d!==t.avail_out&&e.mode<U&&(e.mode<_t||i!==ri))&&mn(t,t.output,t.next_out,d-t.avail_out),g-=t.avail_in,d-=t.avail_out,t.total_in+=g,t.total_out+=d,e.total+=d,e.wrap&4&&d&&(t.adler=e.check=e.flags?L(e.check,a,d,t.next_out-d):ze(e.check,a,d,t.next_out-d)),t.data_type=e.bits+(e.last?64:0)+(e.mode===Y?128:0)+(e.mode===Pe||e.mode===ut?256:0),(g===0&&d===0||i===ri)&&z===le&&(z=Zr),z},Xr=t=>{if(oe(t))return P;let i=t.state;return i.window&&(i.window=null),t.state=null,le},qr=(t,i)=>{if(oe(t))return P;const e=t.state;return(e.wrap&2)===0?P:(e.head=i,i.done=!1,le)},Qr=(t,i)=>{const e=i.length;let n,a,r;return oe(t)||(n=t.state,n.wrap!==0&&n.mode!==Ve)?P:n.mode===Ve&&(a=1,a=ze(a,i,e,0),a!==n.check)?un:(r=mn(t,i,e,e),r?(n.mode=gn,_n):(n.havedict=1,le))};var Jr=pn,Wr=yn,es=bn,ts=jr,is=vn,ns=Vr,as=Xr,rs=qr,ss=Qr,ls="pako inflate (from Nodeca project)",X={inflateReset:Jr,inflateReset2:Wr,inflateResetKeep:es,inflateInit:ts,inflateInit2:is,inflate:ns,inflateEnd:as,inflateGetHeader:rs,inflateSetDictionary:ss,inflateInfo:ls};function os(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var hs=os;const xn=Object.prototype.toString,{Z_NO_FLUSH:fs,Z_FINISH:cs,Z_OK:Le,Z_STREAM_END:bt,Z_NEED_DICT:pt,Z_STREAM_ERROR:ds,Z_DATA_ERROR:Ui,Z_MEM_ERROR:us}=qe;function tt(t){this.options=Je.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),i.windowBits>=0&&i.windowBits<16&&!(t&&t.windowBits)&&(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&(i.windowBits&15)===0&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new hn,this.strm.avail_out=0;let e=X.inflateInit2(this.strm,i.windowBits);if(e!==Le)throw new Error(re[e]);if(this.header=new hs,X.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=Be.string2buf(i.dictionary):xn.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(e=X.inflateSetDictionary(this.strm,i.dictionary),e!==Le)))throw new Error(re[e])}tt.prototype.push=function(t,i){const e=this.strm,n=this.options.chunkSize,a=this.options.dictionary;let r,s,l;if(this.ended)return!1;for(i===~~i?s=i:s=i===!0?cs:fs,xn.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(n),e.next_out=0,e.avail_out=n),r=X.inflate(e,s),r===pt&&a&&(r=X.inflateSetDictionary(e,a),r===Le?r=X.inflate(e,s):r===Ui&&(r=pt));e.avail_in>0&&r===bt&&e.state.wrap>0&&t[e.next_in]!==0;)X.inflateReset(e),r=X.inflate(e,s);switch(r){case ds:case Ui:case pt:case us:return this.onEnd(r),this.ended=!0,!1}if(l=e.avail_out,e.next_out&&(e.avail_out===0||r===bt))if(this.options.to==="string"){let c=Be.utf8border(e.output,e.next_out),o=e.next_out-c,h=Be.buf2string(e.output,c);e.next_out=o,e.avail_out=n-o,o&&e.output.set(e.output.subarray(c,c+o),0),this.onData(h)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(r===Le&&l===0)){if(r===bt)return r=X.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};tt.prototype.onData=function(t){this.chunks.push(t)};tt.prototype.onEnd=function(t){t===Le&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Je.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function _s(t,i){const e=new tt(i);if(e.push(t),e.err)throw e.msg||re[e.err];return e.result}var gs=_s,ws={inflate:gs};const{deflate:bs}=Tr,{inflate:ps}=ws;var ys=bs,vs=ps;const kn=0,ms=1;class xs{ctype=0;outputPos=0;dsize_bits=0;dsize_mask=0;bit_buff=0;extra_bits=0;in_pos=0;in_buff;out_buff=[];constructor(i){this.in_buff=i}}const Bi=0,ks=1,En=new Uint8Array([2,4,4,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8]),Es=new Uint8Array([3,13,5,25,9,17,1,62,30,46,14,54,22,38,6,58,26,42,10,50,18,34,66,2,124,60,92,28,108,44,76,12,116,52,84,20,100,36,68,4,120,56,88,24,104,40,72,8,240,112,176,48,208,80,144,16,224,96,160,32,192,64,128,0]),Is=new Uint8Array([0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8]),As=new Uint16Array([0,1,2,3,4,5,6,7,8,10,14,22,38,70,134,262]),In=new Uint8Array([3,2,3,3,4,4,4,5,5,5,5,6,6,6,7,7]),Ss=new Uint8Array([5,3,1,6,10,2,12,20,4,24,8,48,16,32,64,0]),me=new Uint8Array([11,12,12,12,12,12,12,12,12,8,7,12,12,7,12,12,12,12,12,12,12,12,12,12,12,12,13,12,12,12,12,12,4,10,8,12,10,12,10,8,7,7,8,9,7,6,7,8,7,6,7,7,7,7,8,7,7,8,8,12,11,7,9,11,12,6,7,6,6,5,7,8,8,6,11,9,6,7,6,6,7,11,6,6,6,7,9,8,9,9,11,8,11,9,12,8,12,5,6,6,6,5,6,6,6,5,11,7,5,6,5,5,6,10,5,5,5,5,8,7,8,8,10,11,11,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,12,13,13,13,12,13,13,13,12,13,13,13,13,12,13,13,13,12,12,12,13,13,13,13,13,13,13,13,13,13,13]),ce=new Uint16Array([1168,4064,2016,3040,992,3552,1504,2528,480,184,98,3808,1760,34,2784,736,3296,1248,2272,224,3936,1888,2912,864,3424,1376,4672,2400,352,3680,1632,2656,15,592,56,608,80,3168,912,216,66,2,88,432,124,41,60,152,92,9,28,108,44,76,24,12,116,232,104,1120,144,52,176,1808,2144,49,84,17,33,23,20,168,40,1,784,304,62,100,30,46,36,1296,14,54,22,68,48,200,464,208,272,72,1552,336,96,136,4e3,7,38,6,58,27,26,42,10,11,528,4,19,50,3,29,18,400,13,21,5,25,8,120,240,112,656,1040,16,1952,2976,928,576,7232,3136,5184,1088,6208,2112,4160,64,8064,3968,6016,1920,7040,2944,4992,896,7552,3456,5504,1408,6528,2432,4480,384,7808,3712,5760,1664,6784,2688,4736,640,7296,3200,5248,1152,6272,2176,4224,128,7936,3840,5888,1792,6912,2816,4864,3488,1440,2464,416,3744,1696,2720,672,3232,1184,2208,160,3872,1824,2848,800,3360,1312,2336,288,3616,1568,2592,544,3104,1056,2080,32,4032,1984,3008,960,3520,1472,2496,448,3776,1728,2752,704,3264,1216,2240,192,3904,1856,2880,832,768,3392,7424,3328,5376,1344,1280,6400,2304,2368,4352,256,7680,3584,320,5632,1536,6656,3648,1600,2624,2560,4608,512,7168,3072,5120,1024,6144,2048,4096,0]);let Li=!1;const An=new Uint8Array(256),Sn=new Uint8Array(256);let Ni=!1;const Tt=new Uint8Array(256),Tn=new Uint8Array(256),zn=new Uint8Array(128),Un=new Uint8Array(256);function Ci(t,i,e){for(let n=0,a=i.length;n<a;n++){const r=1<<e[n];for(let s=i[n];s<256;s+=r)t[s]=n}}function Ts(){let t=255,i,e;for(let n=255;t>=0;t--,n--){const a=n;let r=me[a];if(r<=8){e=1<<r,i=ce[t];do Tt[i]=n,i+=e;while(i<256)}else if((i=ce[t]&255)!=0)if(Tt[i]=255,ce[t]&63){r-=4,me[a]=r,e=1<<r,i=ce[t]>>4;do Tn[i]=n,i+=e;while(i<256)}else{r-=6,me[a]=r,e=1<<r,i=ce[t]>>6;do zn[i]=n,i+=e;while(i<128)}else{r-=8,me[a]=r,e=1<<r,i=ce[t]>>8;do Un[i]=n,i+=e;while(i<256)}}}function Z(t,i){return i<=t.extra_bits?(t.extra_bits-=i,t.bit_buff>>=i,Bi):(t.bit_buff>>=t.extra_bits,t.in_pos===t.in_buff.byteLength?ks:(t.bit_buff|=t.in_buff[t.in_pos++]<<8,t.bit_buff>>=i-t.extra_bits,t.extra_bits=t.extra_bits-i+8,Bi))}function zs(t){if(t.bit_buff&1){if(Z(t,1))return 774;let e=Sn[t.bit_buff&255];if(Z(t,In[e]))return 774;let n;if((n=Is[e])!=0){const a=t.bit_buff&(1<<n)-1;if(Z(t,n)&&e+a!=270)return 774;e=As[e]+a}return e+256}if(Z(t,1))return 774;if(t.ctype==kn){const e=t.bit_buff&255;return Z(t,8)?774:e}let i;if(t.bit_buff&255){if(i=Tt[t.bit_buff&255],i==255)if(t.bit_buff&63){if(Z(t,4))return 774;i=Tn[t.bit_buff&255]}else{if(Z(t,6))return 774;i=zn[t.bit_buff&127]}}else{if(Z(t,8))return 774;i=Un[t.bit_buff&255]}return Z(t,me[i])?774:i}function Us(t,i){const e=An[t.bit_buff&255],n=En[e];if(Z(t,n))return 0;let a;if(i==2){if(a=e<<2|t.bit_buff&3,Z(t,2))return 0}else if(a=e<<t.dsize_bits|t.bit_buff&t.dsize_mask,Z(t,t.dsize_bits))return 0;return a+1}function Bs(t){let i;for(;(i=zs(t))<773;)if(i>=256){let e=i-254,n;if((n=Us(t,e))==0)return 774;let a=t.outputPos,r=a-n;for(t.outputPos+=e;e-- >0;)t.out_buff[a++]=t.out_buff[r++]}else t.out_buff[t.outputPos++]=i;return i}function Ri(t){const i=new xs(t);if(i.in_buff.byteLength<=4)throw new Error("Bad data");if(i.ctype=i.in_buff[0],i.dsize_bits=i.in_buff[1],i.bit_buff=i.in_buff[2],i.extra_bits=0,i.in_pos=3,4>i.dsize_bits||i.dsize_bits>6)throw new Error("Invalid dictionary size");if(i.dsize_mask=65535>>16-i.dsize_bits,i.ctype!==kn){if(i.ctype!==ms)throw new Error("Invalid mode");Ni||(Ts(),Ni=!0)}if(Li||(Ci(Sn,Ss,In),Ci(An,Es,En),Li=!0),Bs(i)===774)throw new Error("Error while expanding");return new Uint8Array(i.out_buff)}function Bn(t){let i=-1;for(let e=0,n=Math.ceil(t.byteLength/512);e<n;e++){const a=e*512;t[a]===77&&t[a+1]===80&&t[a+2]===81&&t[a+3]===26&&(i=a)}return i}function Ls(t){return t[0]===72&&t[1]===77&&t[2]===51&&t[3]===87?!0:Bn(t)!==-1}class Mi{archive;c;name;nameResolved;hash;block;rawBuffer=null;buffer=null;constructor(i,e,n,a,r){const s=i.headerOffset;this.archive=i,this.c=i.c,this.name=`File${`${e.blockIndex}`.padStart(8,"0")}`,this.nameResolved=!1,this.hash=e,this.block=n,a&&(this.rawBuffer=a.slice(s+n.offset,s+n.offset+n.compressedSize)),r&&(this.buffer=r)}bytes(){return this.buffer===null&&this.decode(),this.buffer}arrayBuffer(){return this.bytes().buffer}text(){return Ln(this.bytes())}set(i){if(this.archive.readonly)return!1;const e=this.hash,n=this.block;return e.locale=0,e.platform=0,n.compressedSize=0,n.normalSize=i.byteLength,n.flags=0,this.buffer=i,this.rawBuffer=null,!0}delete(){if(this.archive.readonly)return!1;const i=this.archive,e=this.hash,n=e.blockIndex;e.delete();for(const a of i.hashTable.entries)a.blockIndex<Ge&&a.blockIndex>n&&(a.blockIndex-=1);return i.blockTable.entries.splice(n,1),i.files.splice(n,1),!0}rename(i){if(this.archive.readonly)return!1;const e=this.hash,n=e.locale,a=e.platform,r=e.blockIndex;e.delete();const s=this.archive.hashTable.add(i,r);return s.locale=n,s.platform=a,this.name=i,this.nameResolved=!0,this.hash=s,!0}decode(){if(!this.rawBuffer)throw new Error(`File ${this.name}: Nothing to decode`);const i=this.archive,e=this.block,n=i.c,a=n.computeFileKey(this.name,e),r=this.rawBuffer,s=e.flags;if(s===De)this.buffer=r.slice(0,e.normalSize);else if(s&Kt){let l;s&at?l=n.decryptBlock(r.slice(0,e.compressedSize),a):l=r.subarray(0,e.compressedSize),s&nt?l=this.decompressSector(l,e.normalSize):l=l.slice(),this.buffer=l}else{const l=Math.ceil(e.normalSize/i.sectorSize),c=new Uint8Array(e.normalSize);let o=new Uint32Array(r.buffer,0,l+1);s&at&&(o=n.decryptBlock(o.slice(),a-1));let h=o[0],g=o[1],d=0;for(let f=0;f<l;f++){let _;if(s&at?_=n.decryptBlock(r.slice(h,g),a+f):_=r.subarray(h,g),s&nt){let T=i.sectorSize;e.normalSize-d<T&&(T=e.normalSize-d),_=this.decompressSector(_,T)}s&Dn&&(_=Ri(_)),c.set(_,d),d+=_.byteLength,f<l&&(h=g,g=o[f+2])}this.buffer=c}i.readonly&&(this.rawBuffer=null)}decompressSector(i,e){if(i.byteLength===e)return i;{const n=i[0];if(n&$n)throw new Error(`File ${this.name}: compression type 'bzip2' not supported`);if(n&Zn)try{i=Ri(i.subarray(1))}catch(a){throw new Error(`File ${this.name}: failed to decompress with 'explode': ${a}`)}if(n&Fn)try{i=vs(i.subarray(1))}catch(a){throw new Error(`File ${this.name}: failed to decompress with 'zlib': ${a}`)}if(n&On)throw new Error(`File ${this.name}: compression type 'huffman' not supported`);if(n&Hn)throw new Error(`File ${this.name}: compression type 'adpcm stereo' not supported`);if(n&Pn)throw new Error(`File ${this.name}: compression type 'adpcm mono' not supported`);return i}}encode(){if(this.buffer!==null&&this.rawBuffer===null){const i=this.buffer;if(Ls(i))this.rawBuffer=this.buffer,this.block.compressedSize=this.buffer.byteLength,this.block.flags=De;else{const e=this.archive.sectorSize,n=Math.ceil(i.byteLength/e),a=new Uint32Array(n+1);let r=a.byteLength;const s=[],l=[];a[0]=r;for(let c=0;c<n;c++){const o=c*e;let h=i.subarray(o,o+e),g=h.byteLength;const d=ys(h);let f=!1;d.byteLength+1<g&&(h=d,g=d.byteLength+1,f=!0),r+=g,a[c+1]=r,s[c]=h,l[c]=f}if(r<i.byteLength){const c=new Uint8Array(r);c.set(new Uint8Array(a.buffer)),r=a.byteLength;for(let o=0;o<n;o++){l[o]&&(c[r]=2,r+=1);const h=s[o];c.set(h,r),r+=h.byteLength}this.rawBuffer=c,this.block.compressedSize=c.byteLength,this.block.flags=(De|nt)>>>0}else this.rawBuffer=this.buffer,this.block.compressedSize=this.buffer.byteLength,this.block.flags=De}}}reEncrypt(i){if(!this.rawBuffer)return!1;const e=this.archive,n=this.block,a=e.c,r=this.rawBuffer,s=n.flags,l=a.computeFileKey(this.name,n);n.offset=i;const c=a.computeFileKey(this.name,n);if(s&Kt)a.decryptBlock(r,l),a.encryptBlock(r,c);else{const o=Math.ceil(n.normalSize/e.sectorSize),h=new Uint32Array(r.buffer,0,o+1);a.decryptBlock(h,l-1);let g=h[0],d=h[1];for(let f=0;f<o;f++){const _=r.subarray(g,d);a.decryptBlock(_,l+f),a.encryptBlock(_,c+f),f<o&&(g=d,d=h[f+2])}a.encryptBlock(h,c-1)}return!0}offsetChanged(i){const e=this.block;return e.offset!==i&&e.flags&Zi?this.nameResolved?this.reEncrypt(i):!1:(e.offset=i,!0)}}class Ns{nameA=4294967295;nameB=4294967295;locale=65535;platform=65535;blockIndex=Fi;load(i){const e=i[2];this.nameA=i[0],this.nameB=i[1],this.locale=e&65535,this.platform=e>>>16,this.blockIndex=i[3]}copy(i){this.nameA=i.nameA,this.nameB=i.nameB,this.locale=i.locale,this.platform=i.platform,this.blockIndex=i.blockIndex}save(i){i[0]=this.nameA,i[1]=this.nameB,i[2]=this.locale<<16|this.platform,i[3]=this.blockIndex}delete(){this.nameA=4294967295,this.nameB=4294967295,this.locale=65535,this.platform=65535,this.blockIndex=Ge}}class Cs{c;entries;constructor(i){this.c=i,this.entries=[],this.addEmpties(4)}clear(){this.entries.length=0}addEmpties(i){for(let e=0;e<i;e++)this.entries.push(new Ns)}getInsertionIndex(i){const e=this.entries,n=this.c.hash(i,Zt)&e.length-1;for(let a=0,r=e.length;a<r;a++){const s=(a+n)%r;if(e[s].platform===65535)return s}return-1}add(i,e){const n=this.getInsertionIndex(i);if(n!==-1){const a=this.entries[n];return a.nameA=this.c.hash(i,$t),a.nameB=this.c.hash(i,Pt),a.locale=0,a.platform=0,a.blockIndex=e,a}}load(i){const e=i.byteLength/16,n=new Uint32Array(this.c.decryptBlock(i,Ft).buffer);let a=0;this.clear(),this.addEmpties(e);for(const r of this.entries)r.load(n.subarray(a,a+4)),a+=4}save(i){const e=new Uint32Array(this.entries.length*4);let n=0;for(const r of this.entries)r.save(e.subarray(n,n+4)),n+=4;const a=new Uint8Array(e.buffer);this.c.encryptBlock(a,Ft),i.set(a)}get(i){const e=this.c,n=this.entries,a=e.hash(i,Zt)&n.length-1,r=e.hash(i,$t),s=e.hash(i,Pt);for(let l=0,c=n.length;l<c;l++){const o=n[(l+a)%c];if(r===o.nameA&&s===o.nameB)return o;if(o.blockIndex===4294967295)return null}return null}}class Rs{headerOffset;sectorSize;c;hashTable;blockTable;files;readonly=!1;constructor(){this.headerOffset=0,this.sectorSize=4096,this.c=new Gn,this.hashTable=new Cs(this.c),this.blockTable=new Kn(this.c),this.files=[]}load(i,e=!1){const n=Mt(i);this.readonly=e;const a=Bn(n);if(a===-1)throw new Error("No MPQ header");const r=new Uint32Array(n.buffer,a,8),s=r[3],l=Dt(r[4]+a),c=Dt(r[5]+a),o=r[6];let h=r[7];h>o&&(h=o),this.headerOffset=a,this.sectorSize=512*(1<<(s>>>16)),this.hashTable.load(n.slice(l,l+o*16)),this.blockTable.load(n.slice(c,c+h*16)),this.files.length=0;for(const d of this.hashTable.entries){const f=d.blockIndex;f<this.blockTable.entries.length&&(this.files[f]=new Mi(this,d,this.blockTable.entries[f],n,null))}const g=this.get("(listfile)");if(g){const d=g.text();if(d)for(const f of d.split(`\r
`))this.get(f)}}save(){if(this.readonly)return null;const i=32;this.delete("(attributes)"),this.saveMemory(),this.set("(listfile)",this.getFileNames().join(`\r
`));let e=i;for(const f of this.files)if(f){if(!f.offsetChanged(e))return null;f.encode(),e+=f.block.compressedSize}const n=this.hashTable,a=this.blockTable,r=n.entries.length,s=a.entries.length,l=e-i,c=i+l+r*16+s*16,o=i+l,h=o+r*16,g=new Uint8Array(c),d=new Uint32Array(g.buffer,0,8);d[0]=Rn,d[1]=i,d[2]=c,d[3]=Math.log2(this.sectorSize/512)<<16,d[4]=o,d[5]=h,d[6]=r,d[7]=s,e=i;for(const f of this.files)f&&(f.rawBuffer&&g.set(f.rawBuffer,e),e+=f.block.compressedSize);return n.save(g.subarray(e,e+n.entries.length*16)),e+=n.entries.length*16,a.save(g.subarray(e,e+a.entries.length*16)),g}saveMemory(){if(this.readonly)return 0;const i=this.blockTable.entries,e=this.hashTable.entries;let n=i.length,a=0;for(;n--;){const r=i[n];if(r.normalSize===0)this.removeBlock(n),a+=r.compressedSize;else{let s=!1;for(const l of e)if(l.blockIndex===n){s=!0;break}s||(this.removeBlock(n),a+=r.compressedSize)}}return a}removeBlock(i){for(const e of this.hashTable.entries)e.blockIndex<Ge&&e.blockIndex>i&&(e.blockIndex-=1);this.blockTable.entries.splice(i,1)}getFileNames(){const i=[];for(const e of this.files)e&&e.name!==""&&i.push(e.name);return i}countUnresolved(){let i=0;for(const e of this.files)e.nameResolved||i++;return i}applyListfile(i){for(const e of i)this.get(e)}set(i,e){if(this.readonly)return!1;const n=Mt(e);let a=this.get(i);if(a)a.set(n);else{const r=this.blockTable.entries.length,s=this.hashTable.add(i,r);if(!s)return!1;const l=this.blockTable.add(n);a=new Mi(this,s,l,null,n),a.name=i,a.nameResolved=!0,this.files[r]=a}return!0}get(i){const e=this.hashTable.get(i);if(e){const n=e.blockIndex;if(n<Ge){const a=this.files[n];if(a)return a.name=i,a.nameResolved=!0,a}}return null}has(i){return!!this.get(i)}delete(i){if(this.readonly)return!1;const e=this.get(i);return e?(e.delete(),!0):!1}rename(i,e){if(this.readonly)return!1;const n=this.get(i);return n?(n.rename(e),!0):!1}resizeHashtable(i){if(this.readonly)return!1;i=Math.max(4,Cn(i));const e=this.files;if(e.length>i)return!1;for(const s of e)if(!s.nameResolved)return!1;const n=this.hashTable,a=n.entries,r=a.slice();n.clear(),n.addEmpties(i);for(const s of r)if(s.blockIndex!==Fi){const l=e[s.blockIndex],c=n.getInsertionIndex(l.name);a[c].copy(s)}return!0}}class Di{isCustom=0;path="";load(i){this.isCustom=i.readUint8(),this.path=i.readNull()}save(i){i.writeUint8(this.isCustom),i.writeNull(this.path)}getByteLength(){return 2+A(this.path)}}class Ms{version=1;entries=new Map;load(i){const e=new R(i);this.version=e.readUint32();for(let n=0,a=e.readUint32();n<a;n++){const r=new Di;r.load(e),r.isCustom?this.entries.set(r.path,r):this.entries.set(`war3mapimported\\${r.path}`,r)}}save(){const i=new R(new ArrayBuffer(this.getByteLength()));i.writeUint32(this.version),i.writeUint32(this.entries.size);for(const e of this.entries.values())e.save(i);return i.uint8array}getByteLength(){let i=8;for(const e of this.entries.values())i+=e.getByteLength();return i}set(i){if(!this.entries.has(i)){const e=new Di;return e.isCustom=10,e.path=i,this.entries.set(i,e),!0}return!1}has(i){return this.entries.has(i)}delete(i){return this.entries.delete(i)}rename(i,e){const n=this.entries.get(i);return n?(n.isCustom=10,n.path=e,!0):!1}}class Ds{id="\0\0\0\0";variableType=0;levelOrVariation=0;dataPointer=0;value=0;u1=0;load(i,e){if(this.id=i.readBinary(4),this.variableType=i.readInt32(),e&&(this.levelOrVariation=i.readInt32(),this.dataPointer=i.readInt32()),this.variableType===0)this.value=i.readInt32();else if(this.variableType===1||this.variableType===2)this.value=i.readFloat32();else if(this.variableType===3)this.value=i.readNull();else throw new Error(`Modification: unknown variable type ${this.variableType}`);this.u1=i.readInt32()}save(i,e){if(i.writeBinary(this.id),i.writeInt32(this.variableType),e&&(i.writeInt32(this.levelOrVariation),i.writeInt32(this.dataPointer)),this.variableType===0)i.writeInt32(this.value);else if(this.variableType===1||this.variableType===2)i.writeFloat32(this.value);else if(this.variableType===3)i.writeNull(this.value);else throw new Error(`Modification: unknown variable type ${this.variableType}`);i.writeInt32(this.u1)}getByteLength(i){let e=12;return i&&(e+=8),this.variableType===3?e+=A(this.value)+1:e+=4,e}}class Os{oldId="\0\0\0\0";newId="\0\0\0\0";sets=1;setsFlag=[];modifications=[];load(i,e,n){this.oldId=i.readBinary(4),this.newId=i.readBinary(4),n>=3&&(this.sets=i.readUint32());for(let a=0;a<this.sets;a++){n>=3&&(this.setsFlag[a]=i.readUint32());for(let r=0,s=i.readUint32();r<s;r++){const l=new Ds;l.load(i,e),this.modifications[r]=l}}}save(i,e,n){this.oldId!=="\0\0\0\0"?i.writeBinary(this.oldId):i.writeUint32(0),this.newId!=="\0\0\0\0"?i.writeBinary(this.newId):i.writeUint32(0),n>=3&&i.writeUint32(this.sets),i.writeUint32(this.modifications.length);for(let a=0;a<this.sets;a++){n>=3&&i.writeUint32(this.setsFlag[a]);for(const r of this.modifications)r.save(i,e)}}getByteLength(i,e){let n=e>=3?16:12;for(let a=0;a<this.sets;a++){e>=3&&(n+=4);for(const r of this.modifications)n+=r.getByteLength(i)}return n}}class Xe{objects=[];load(i,e,n){for(let a=0,r=i.readUint32();a<r;a++){const s=new Os;s.load(i,e,n),this.objects[a]=s}}save(i,e,n){i.writeUint32(this.objects.length);for(const a of this.objects)a.save(i,e,n)}getByteLength(i,e){let n=4;for(const a of this.objects)n+=a.getByteLength(i,e);return n}}class Fs{version=0;originalTable=new Xe;customTable=new Xe;load(i){let e;i instanceof R?e=i:e=new R(i),this.version=e.readInt32(),this.originalTable.load(e,!0,this.version),this.customTable.load(e,!0,this.version)}save(){const i=new R(new ArrayBuffer(this.getByteLength()));return i.writeInt32(this.version),this.originalTable.save(i,!0,this.version),this.customTable.save(i,!0,this.version),i.uint8array}getByteLength(){return 4+this.originalTable.getByteLength(!0,this.version)+this.customTable.getByteLength(!0,this.version)}}class Zs{version=0;originalTable=new Xe;customTable=new Xe;load(i){let e;i instanceof R?e=i:e=new R(i),this.version=e.readInt32(),this.originalTable.load(e,!1,this.version),this.customTable.load(e,!1,this.version)}save(){const i=new R(new ArrayBuffer(this.getByteLength()));return i.writeInt32(this.version),this.originalTable.save(i,!1,this.version),this.customTable.save(i,!1,this.version),i.uint8array}getByteLength(){return 4+this.originalTable.getByteLength(!1,this.version)+this.customTable.getByteLength(!1,this.version)}}class Oi{text="";load(i){const e=i.readInt32();e&&(this.text=i.read(e-1),i.skip(1))}save(i){this.text.length?(i.writeInt32(A(this.text)+1),i.write(this.text),i.skip(1)):i.writeInt32(0)}getByteLength(){let i=4;return this.text.length&&(i+=A(this.text)+1),i}}class $s{version=0;comment="";trigger=new Oi;triggers=[];load(i){const e=new R(i);this.version=e.readInt32(),this.version===1&&(this.comment=e.readNull(),this.trigger.load(e));for(let n=0,a=e.readUint32();n<a;n++){const r=new Oi;r.load(e),this.triggers[n]=r}}save(){const i=new R(new ArrayBuffer(this.getByteLength()));i.writeInt32(this.version),this.version===1&&(i.writeNull(this.comment),this.trigger.save(i)),i.writeUint32(this.triggers.length);for(const e of this.triggers)e.save(i);return i.uint8array}getByteLength(){let i=8;this.version===1&&(i+=A(this.comment)+1+this.trigger.getByteLength());for(const e of this.triggers)i+=e.getByteLength();return i}}class Ps{id=0;name="";isComment=0;load(i,e){this.id=i.readInt32(),this.name=i.readNull(),e===7&&(this.isComment=i.readInt32())}save(i,e){i.writeInt32(this.id),i.writeNull(this.name),e===7&&i.writeInt32(this.isComment)}getByteLength(i){let e=5+A(this.name);return i===7&&(e+=4),e}}class Hs{name="";type="";u1=0;isArray=0;arraySize=0;isInitialized=0;initialValue="";load(i,e){this.name=i.readNull(),this.type=i.readNull(),this.u1=i.readInt32(),this.isArray=i.readInt32(),e===7&&(this.arraySize=i.readInt32()),this.isInitialized=i.readInt32(),this.initialValue=i.readNull()}save(i,e){i.writeNull(this.name),i.writeNull(this.type),i.writeInt32(this.u1),i.writeInt32(this.isArray),e===7&&i.writeInt32(this.arraySize),i.writeInt32(this.isInitialized),i.writeNull(this.initialValue)}getByteLength(i){let e=15+A(this.name)+A(this.type)+A(this.initialValue);return i===7&&(e+=4),e}}class Ks{type=0;name="";beginParameters=0;parameters=[];load(i,e,n){if(this.type=i.readInt32(),this.type<0||this.type>3)throw new Error(`SubParameters: Bad type: ${this.type}`);if(this.name=i.readNull(),this.name.length===0)throw new Error("SubParameters: Empty name");if(this.beginParameters=i.readInt32(),this.beginParameters){const a=n.getFunction(this.type,this.name);if(!a)throw new Error(`SubParameters "${this.name}:${this.type}": Unknown signature`);const r=a.args;for(let s=0,l=r.length;s<l;s++){const c=new it;try{c.load(i,e,n)}catch(o){throw new Error(`SubParameters "${this.name}": Parameter ${s}: ${o}`)}this.parameters[s]=c}}}save(i,e){i.writeInt32(this.type),i.writeNull(this.name),i.writeInt32(this.beginParameters);for(const n of this.parameters)n.save(i,e)}getByteLength(i){let e=9+A(this.name);if(this.parameters.length)for(const n of this.parameters)e+=n.getByteLength(i);return e}}class it{type=0;value="";subParameters=null;u1=0;isArray=0;arrayIndex=null;load(i,e,n){if(this.type=i.readInt32(),this.type<-1||this.type>3)throw new Error(`Parameter: Bad type: ${this.type}`);if(this.value=i.readNull(),i.readInt32()){const a=new Ks;try{a.load(i,e,n)}catch(r){throw new Error(`Parameter "${this.value}": SubParameters ${r}`)}this.subParameters=a}if((e===4&&this.type===2||e===7&&this.subParameters)&&(this.u1=i.readInt32()),(e===4&&this.type!==2||e===7)&&(this.isArray=i.readInt32()),this.isArray){const a=new it;try{a.load(i,e,n)}catch(r){throw new Error(`Parameter "${this.value}": ArrayIndex: ${r}`)}this.arrayIndex=a}}save(i,e){i.writeInt32(this.type),i.writeNull(this.value),this.subParameters?(i.writeInt32(1),this.subParameters.save(i,e)):i.writeInt32(0),(e===4&&this.type===2||e===7&&this.subParameters)&&i.writeInt32(this.u1),(e===4&&this.type!==2||e===7)&&i.writeInt32(this.isArray),this.isArray&&this.arrayIndex&&this.arrayIndex.save(i,e)}getByteLength(i){let e=9+A(this.value);return this.subParameters&&(e+=this.subParameters.getByteLength(i)),(i===4&&this.type===2||i===7&&this.subParameters)&&(e+=4),(i===4&&this.type!==2||i===7)&&(e+=4),this.isArray&&this.arrayIndex&&(e+=this.arrayIndex.getByteLength(i)),e}}class Ct{type=-1;group=-1;name="";isEnabled=0;parameters=[];ecas=[];load(i,e,n,a){if(this.type=i.readInt32(),this.type<0||this.type>3)throw new Error(`ECA: Bad type: ${this.type}`);if(n&&(this.group=i.readUint32()),this.name=i.readNull(),this.name.length===0)throw new Error("ECA: Empty name");this.isEnabled=i.readInt32();const r=a.getFunction(this.type,this.name);if(!r)throw new Error(`ECA "${this.name}:${this.type}": Unknown signature`);const s=r.args;for(let l=0,c=s.length;l<c;l++){const o=new it;try{o.load(i,e,a)}catch(h){throw new Error(`ECA "${this.name}": Parameter ${l}: ${h}`)}this.parameters[l]=o}if(e===7)for(let l=0,c=i.readUint32();l<c;l++){const o=new Ct;try{o.load(i,e,!0,a)}catch(h){throw new Error(`ECA "${this.name}": Child ECA ${l} ${h}`)}this.ecas[l]=o}}save(i,e){i.writeInt32(this.type),this.group!==-1&&i.writeInt32(this.group),i.writeNull(this.name),i.writeInt32(this.isEnabled);for(const n of this.parameters)n.save(i,e);if(e===7){i.writeUint32(this.ecas.length);for(const n of this.ecas)n.save(i,e)}}getByteLength(i){let e=9+A(this.name);this.group!==-1&&(e+=4);for(const n of this.parameters)e+=n.getByteLength(i);if(i===7){e+=4;for(const n of this.ecas)e+=n.getByteLength(i)}return e}}class Gs{name="";description="";isComment=0;isEnabled=0;isCustom=0;isInitiallyOff=0;runOnInitialization=0;category=0;ecas=[];load(i,e,n){this.name=i.readNull(),this.description=i.readNull(),e===7&&(this.isComment=i.readInt32()),this.isEnabled=i.readInt32(),this.isCustom=i.readInt32(),this.isInitiallyOff=i.readInt32(),this.runOnInitialization=i.readInt32(),this.category=i.readInt32();for(let a=0,r=i.readUint32();a<r;a++){const s=new Ct;try{s.load(i,e,!1,n)}catch(l){throw new Error(`Trigger "${this.name}": ECA ${a}: ${l}`)}this.ecas[a]=s}}save(i,e){i.writeNull(this.name),i.writeNull(this.description),e===7&&i.writeInt32(this.isComment),i.writeInt32(this.isEnabled),i.writeInt32(this.isCustom),i.writeInt32(this.isInitiallyOff),i.writeInt32(this.runOnInitialization),i.writeInt32(this.category),i.writeUint32(this.ecas.length);for(const n of this.ecas)n.save(i,e)}getByteLength(i){let e=26+A(this.name)+A(this.description);i===7&&(e+=4);for(const n of this.ecas)e+=n.getByteLength(i);return e}}class js{version=0;categories=[];u1=0;variables=[];triggers=[];load(i,e){const n=new R(i);if(n.readBinary(4)!=="WTG!")throw new Error("Not a WTG file");this.version=n.readInt32();for(let a=0,r=n.readUint32();a<r;a++){const s=new Ps;s.load(n,this.version),this.categories[a]=s}this.u1=n.readInt32();for(let a=0,r=n.readUint32();a<r;a++){const s=new Hs;s.load(n,this.version),this.variables[a]=s}for(let a=0,r=n.readUint32();a<r;a++){const s=new Gs;try{s.load(n,this.version,e)}catch(l){throw new Error(`Trigger ${a}: ${l}`)}this.triggers[a]=s}}save(){const i=new R(new ArrayBuffer(this.getByteLength()));i.writeBinary("WTG!"),i.writeInt32(this.version),i.writeUint32(this.categories.length);for(const e of this.categories)e.save(i,this.version);i.writeInt32(this.u1),i.writeUint32(this.variables.length);for(const e of this.variables)e.save(i,this.version);i.writeUint32(this.triggers.length);for(const e of this.triggers)e.save(i,this.version);return i.uint8array}getByteLength(){let i=24;const e=this.version;for(const n of this.categories)i+=n.getByteLength(e);for(const n of this.variables)i+=n.getByteLength(e);for(const n of this.triggers)i+=n.getByteLength(e);return i}}class Ys{stringMap=new Map;load(i){const e=new Nn(i);let n;const a=i.indexOf("STRING");if(a===-1)throw new Error("Not a valid war3map.wts buffer");for(e.index=a;n=e.readToken();)if(n==="STRING"){const r=e.readInt();e.read();const s=i.indexOf("}",e.index);if(s===-1)throw this.stringMap.set(r,i.slice(e.index,i.length).trim()),new Error(`WTS: missing data in string ${this.stringMap.size} (and maybe more)`);this.stringMap.set(r,i.slice(e.index,s).trim()),e.index=s}}save(){let i="";for(const[e,n]of this.stringMap)i+=`STRING ${e}\r
{\r
${n}\r
}\r
\r
`;return i}getString(i){if(typeof i=="string"){if(i.startsWith("TRIGSTR_"))return this.stringMap.get(parseInt(i.slice(8)))}else return this.stringMap.get(i)}setString(i,e){typeof i=="string"?i.startsWith("TRIGSTR_")&&this.stringMap.set(parseInt(i.slice(8)),e):this.stringMap.set(i,e)}}class Vs{flags=0;playerMasks=0;name="";load(i){this.flags=i.readUint32(),this.playerMasks=i.readUint32(),this.name=i.readNull()}save(i){i.writeUint32(this.flags),i.writeUint32(this.playerMasks),i.writeNull(this.name)}getByteLength(){return 9+A(this.name)}}class Xs{id=0;type=0;race=0;isFixedStartPosition=0;name="";startLocation=new Float32Array(2);allyLowPriorities=0;allyHighPriorities=0;unknown1=new Uint8Array(8);load(i,e){this.id=i.readInt32(),this.type=i.readInt32(),this.race=i.readInt32(),this.isFixedStartPosition=i.readInt32(),this.name=i.readNull(),i.readFloat32Array(this.startLocation),this.allyLowPriorities=i.readUint32(),this.allyHighPriorities=i.readUint32(),e>30&&i.readUint8Array(this.unknown1)}save(i,e){i.writeInt32(this.id),i.writeInt32(this.type),i.writeInt32(this.race),i.writeInt32(this.isFixedStartPosition),i.writeNull(this.name),i.writeFloat32Array(this.startLocation),i.writeUint32(this.allyLowPriorities),i.writeUint32(this.allyHighPriorities),e>30&&i.writeUint8Array(this.unknown1)}getByteLength(i){let e=33+A(this.name);return i>30&&(e+=8),e}}class qs{chance=0;id="\0\0\0\0";load(i){this.chance=i.readInt32(),this.id=i.readBinary(4)}save(i){i.writeInt32(this.chance),i.writeBinary(this.id)}}class Qs{items=[];load(i){for(let e=0,n=i.readUint32();e<n;e++){const a=new qs;a.load(i),this.items[e]=a}}save(i){i.writeUint32(this.items.length);for(const e of this.items)e.save(i)}getByteLength(){return 4+this.items.length*8}}class Js{id=0;name="";sets=[];load(i){this.id=i.readInt32(),this.name=i.readNull();for(let e=0,n=i.readUint32();e<n;e++){const a=new Qs;a.load(i),this.sets[e]=a}}save(i){i.writeInt32(this.id),i.writeNull(this.name),i.writeUint32(this.sets.length);for(const e of this.sets)e.save(i)}getByteLength(){let i=9+A(this.name);for(const e of this.sets)i+=e.getByteLength();return i}}class Ws{chance=0;ids=[];load(i,e){this.chance=i.readInt32();for(let n=0;n<e;n++)this.ids[n]=i.readBinary(4)}save(i){i.writeInt32(this.chance);for(const e of this.ids)i.writeBinary(e)}}class el{id=0;name="";positions=0;columnTypes=new Int32Array(0);units=[];load(i){this.id=i.readInt32(),this.name=i.readNull(),this.positions=i.readInt32(),this.columnTypes=i.readInt32Array(this.positions);for(let e=0,n=i.readUint32();e<n;e++){const a=new Ws;a.load(i,this.positions),this.units[e]=a}}save(i){i.writeInt32(this.id),i.writeNull(this.name),i.writeInt32(this.positions),i.writeInt32Array(this.columnTypes),i.writeUint32(this.units.length);for(const e of this.units)e.save(i)}getByteLength(){return 13+A(this.name)+this.columnTypes.byteLength+this.units.length*(4+4*this.positions)}}class tl{playerFlags=0;id="\0\0\0\0";load(i){this.playerFlags=i.readUint32(),this.id=i.readBinary(4)}save(i){i.writeUint32(this.playerFlags),i.writeBinary(this.id)}}class il{playerFlags=0;id="\0\0\0\0";levelAffected=0;availability=0;load(i){this.playerFlags=i.readUint32(),this.id=i.readBinary(4),this.levelAffected=i.readInt32(),this.availability=i.readInt32()}save(i){i.writeUint32(this.playerFlags),i.writeBinary(this.id),i.writeInt32(this.levelAffected),i.writeInt32(this.availability)}}class nl{version=0;saves=0;editorVersion=0;buildVersion=new Uint32Array(4);name="";author="";description="";recommendedPlayers="";cameraBounds=new Float32Array(8);cameraBoundsComplements=new Int32Array(4);playableSize=new Int32Array(2);flags=0;tileset="A";campaignBackground=0;loadingScreenModel="";loadingScreenText="";loadingScreenTitle="";loadingScreenSubtitle="";loadingScreen=0;prologueScreenModel="";prologueScreenText="";prologueScreenTitle="";prologueScreenSubtitle="";useTerrainFog=0;fogHeight=new Float32Array(2);fogDensity=0;fogColor=new Uint8Array(4);globalWeather=0;soundEnvironment="";lightEnvironmentTileset="\0";waterVertexColor=new Uint8Array(4);scriptMode=0;graphicsMode=0;defaultCameraZoom=0;maxCameraZoom=0;minCameraZoom=0;players=[];forces=[];upgradeAvailabilityChanges=[];techAvailabilityChanges=[];randomUnitTables=[];randomItemTables=[];unknown1=0;load(i){const e=new R(i);this.version=e.readInt32(),this.saves=e.readInt32(),this.editorVersion=e.readInt32(),this.version>27&&e.readUint32Array(this.buildVersion),this.name=e.readNull(),this.author=e.readNull(),this.description=e.readNull(),this.recommendedPlayers=e.readNull(),e.readFloat32Array(this.cameraBounds),e.readInt32Array(this.cameraBoundsComplements),e.readInt32Array(this.playableSize),this.flags=e.readUint32(),this.tileset=e.readBinary(1),this.campaignBackground=e.readInt32(),this.version>24&&(this.loadingScreenModel=e.readNull()),this.loadingScreenText=e.readNull(),this.loadingScreenTitle=e.readNull(),this.loadingScreenSubtitle=e.readNull(),this.loadingScreen=e.readInt32(),this.version>24&&(this.prologueScreenModel=e.readNull()),this.prologueScreenText=e.readNull(),this.prologueScreenTitle=e.readNull(),this.prologueScreenSubtitle=e.readNull(),this.version>24&&(this.useTerrainFog=e.readInt32(),e.readFloat32Array(this.fogHeight),this.fogDensity=e.readFloat32(),e.readUint8Array(this.fogColor),this.globalWeather=e.readInt32(),this.soundEnvironment=e.readNull(),this.lightEnvironmentTileset=e.readBinary(1),e.readUint8Array(this.waterVertexColor)),this.version>27&&(this.scriptMode=e.readUint32()),this.version>30&&(this.graphicsMode=e.readUint32(),this.unknown1=e.readUint32()),this.version>32&&(this.defaultCameraZoom=e.readUint32(),this.maxCameraZoom=e.readUint32(),this.minCameraZoom=e.readUint32());for(let n=0,a=e.readInt32();n<a;n++){const r=new Xs;r.load(e,this.version),this.players[n]=r}for(let n=0,a=e.readInt32();n<a;n++){const r=new Vs;r.load(e),this.forces[n]=r}for(let n=0,a=e.readInt32();n<a;n++){const r=new il;r.load(e),this.upgradeAvailabilityChanges[n]=r}for(let n=0,a=e.readInt32();n<a;n++){const r=new tl;r.load(e),this.techAvailabilityChanges[n]=r}for(let n=0,a=e.readInt32();n<a;n++){const r=new el;r.load(e),this.randomUnitTables[n]=r}if(this.version>24)for(let n=0,a=e.readInt32();n<a;n++){const r=new Js;r.load(e),this.randomItemTables[n]=r}}save(){const i=new R(new ArrayBuffer(this.getByteLength()));i.writeInt32(this.version),i.writeInt32(this.saves),i.writeInt32(this.editorVersion),this.version>27&&i.writeUint32Array(this.buildVersion),i.writeNull(this.name),i.writeNull(this.author),i.writeNull(this.description),i.writeNull(this.recommendedPlayers),i.writeFloat32Array(this.cameraBounds),i.writeInt32Array(this.cameraBoundsComplements),i.writeInt32Array(this.playableSize),i.writeUint32(this.flags),i.writeBinary(this.tileset),i.writeInt32(this.campaignBackground),this.version>24&&i.writeNull(this.loadingScreenModel),i.writeNull(this.loadingScreenText),i.writeNull(this.loadingScreenTitle),i.writeNull(this.loadingScreenSubtitle),i.writeInt32(this.loadingScreen),this.version>24&&i.writeNull(this.prologueScreenModel),i.writeNull(this.prologueScreenText),i.writeNull(this.prologueScreenTitle),i.writeNull(this.prologueScreenSubtitle),this.version>24&&(i.writeInt32(this.useTerrainFog),i.writeFloat32Array(this.fogHeight),i.writeFloat32(this.fogDensity),i.writeUint8Array(this.fogColor),i.writeInt32(this.globalWeather),i.writeNull(this.soundEnvironment),i.writeBinary(this.lightEnvironmentTileset),i.writeUint8Array(this.waterVertexColor)),this.version>27&&i.writeUint32(this.scriptMode),this.version>30&&(i.writeUint32(this.graphicsMode),i.writeUint32(this.unknown1)),this.version>32&&(i.writeUint32(this.defaultCameraZoom),i.writeUint32(this.maxCameraZoom),i.writeUint32(this.minCameraZoom)),i.writeUint32(this.players.length);for(const e of this.players)e.save(i,this.version);i.writeUint32(this.forces.length);for(const e of this.forces)e.save(i);i.writeUint32(this.upgradeAvailabilityChanges.length);for(const e of this.upgradeAvailabilityChanges)e.save(i);i.writeUint32(this.techAvailabilityChanges.length);for(const e of this.techAvailabilityChanges)e.save(i);i.writeUint32(this.randomUnitTables.length);for(const e of this.randomUnitTables)e.save(i);if(this.version>24){i.writeUint32(this.randomItemTables.length);for(const e of this.randomItemTables)e.save(i)}return i.uint8array}getByteLength(){let i=111+A(this.name)+A(this.author)+A(this.description)+A(this.recommendedPlayers)+A(this.loadingScreenText)+A(this.loadingScreenTitle)+A(this.loadingScreenSubtitle)+A(this.prologueScreenText)+A(this.prologueScreenTitle)+A(this.prologueScreenSubtitle);for(const e of this.players)i+=e.getByteLength(this.version);for(const e of this.forces)i+=e.getByteLength();i+=this.upgradeAvailabilityChanges.length*16,i+=this.techAvailabilityChanges.length*8;for(const e of this.randomUnitTables)i+=e.getByteLength();if(this.version>24){i+=36+A(this.loadingScreenModel)+A(this.prologueScreenModel)+A(this.soundEnvironment);for(const e of this.randomItemTables)i+=e.getByteLength()}return this.version>27&&(i+=20),this.version>30&&(i+=8),i}getBuildVersion(){return this.buildVersion[0]*100+this.buildVersion[1]}}class sl{u1=0;name="";flags=0;maxPlayers=0;archive=new Rs;imports=new Ms;readonly=!1;load(i,e=!1){const n=new R(i);n.readBinary(4)==="HM3W"&&(this.u1=n.readUint32(),this.name=n.readNull(),this.flags=n.readUint32(),this.maxPlayers=n.readUint32()),this.readonly=e,this.archive.load(i,e),this.readImports()}save(){this.setImportsFile();const i=this.archive.save();if(!i)throw Error("Failed to save the map MPQ archive");const e=this.getMapInformation();if(!e||e.getBuildVersion()<131){const n=new Uint8Array(512+i.byteLength),a=new R(n);return a.writeBinary("HM3W"),a.writeUint32(this.u1),a.writeNull(this.name),a.writeUint32(this.flags),a.writeUint32(this.maxPlayers),n.set(i,512),n}else return i}getFileNames(){return this.archive.getFileNames()}getImportNames(){const i=[];for(const e of this.imports.entries.values()){const n=e.isCustom;n===10||n===13?i.push(e.path):i.push(`war3mapImported\\${e.path}`)}return i}setImportsFile(){return this.readonly?!1:this.imports.entries.size>0?this.set("war3map.imp",this.imports.save()):!1}import(i,e){return this.readonly?!1:this.archive.set(i,e)?(this.imports.set(i),!0):!1}set(i,e){return this.readonly?!1:this.archive.set(i,e)}get(i){return this.archive.get(i)}getScriptFile(){return this.get("war3map.j")||this.get("scripts\\war3map.j")||this.get("war3map.lua")||this.get("scripts\\war3map.lua")}has(i){return this.archive.has(i)}delete(i){return this.readonly?!1:(this.imports.delete(i),this.archive.delete(i))}rename(i,e){return this.readonly?!1:this.archive.rename(i,e)?(this.imports.rename(i,e),!0):!1}getMapInformation(){const i=this.archive.get("war3map.w3i");if(!i)throw new Error("File does not exist");const e=new nl;return e.load(i.bytes()),e}readImports(){const i=this.archive.get("war3map.imp");if(i){const e=i.arrayBuffer();e&&this.imports.load(e)}}readTriggers(i){const e=this.archive.get("war3map.wtg");if(e){const n=e.arrayBuffer();if(n){const a=new js;return a.load(n,i),a}}}readCustomTextTriggers(){const i=this.archive.get("war3map.wct");if(i){const e=i.arrayBuffer();if(e){const n=new $s;return n.load(e),n}}}readStringTable(){const i=this.archive.get("war3map.wts");if(i){const e=i.text();if(e){const n=new Ys;return n.load(e),n}}}readModifications(){const i={},e=["w3u","w3t","w3b","w3d","w3a","w3h","w3q"],n=[!1,!1,!1,!0,!0,!1,!0];for(let a=0,r=e.length;a<r;a++){const s=this.archive.get(`war3map.${e[a]}`);if(s){const l=s.arrayBuffer();if(l){let c;n[a]?c=new Fs:c=new Zs,c.load(l),i[e[a]]=c}}}return i}}export{Oi as C,Ct as E,Rs as M,it as P,Ks as S,Gs as T,sl as W,nl as a};
