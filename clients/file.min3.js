import{B as a}from"./tokenstream.min.js";class l{id="\0\0\0\0";chance=0;load(i){this.id=i.readBinary(4),this.chance=i.readInt32()}save(i){i.writeBinary(this.id),i.writeInt32(this.chance)}}class d{items=[];load(i){for(let e=0,o=i.readInt32();e<o;e++){const n=new l;n.load(i),this.items[e]=n}}save(i){i.writeInt32(this.items.length);for(const e of this.items)e.save(i)}getByteLength(){return 4+this.items.length*8}}class I{slot=0;id="\0\0\0\0";load(i){this.slot=i.readInt32(),this.id=i.readBinary(4)}save(i){i.writeInt32(this.slot),i.writeBinary(this.id)}}class w{id="\0\0\0\0";activeForAutocast=0;heroLevel=1;load(i){this.id=i.readBinary(4),this.activeForAutocast=i.readInt32(),this.heroLevel=i.readInt32()}save(i){i.writeBinary(this.id),i.writeInt32(this.activeForAutocast),i.writeInt32(this.heroLevel)}}class c{id="\0\0\0\0";chance=0;load(i){this.id=i.readBinary(4),this.chance=i.readInt32()}save(i){i.writeBinary(this.id),i.writeInt32(this.chance)}}class g{id="\0\0\0\0";variation=0;location=new Float32Array(3);angle=0;scale=new Float32Array([1,1,1]);skin="\0\0\0\0";flags=0;player=0;unknown=0;hitpoints=-1;mana=-1;droppedItemTable=0;droppedItemSets=[];goldAmount=0;targetAcquisition=0;heroLevel=0;heroStrength=0;heroAgility=0;heroIntelligence=0;itemsInInventory=[];modifiedAbilities=[];randomFlag=0;level=new Uint8Array(3);itemClass=0;unitGroup=0;positionInGroup=0;randomUnitTables=[];customTeamColor=0;waygate=0;creationNumber=0;load(i,e,o,n){this.id=i.readBinary(4),this.variation=i.readInt32(),i.readFloat32Array(this.location),this.angle=i.readFloat32(),i.readFloat32Array(this.scale),n>131&&(this.skin=i.readBinary(4)),this.flags=i.readUint8(),this.player=i.readInt32(),this.unknown=i.readUint16(),this.hitpoints=i.readInt32(),this.mana=i.readInt32(),o>10&&(this.droppedItemTable=i.readInt32());for(let t=0,s=i.readInt32();t<s;t++){const r=new d;r.load(i),this.droppedItemSets[t]=r}this.goldAmount=i.readInt32(),this.targetAcquisition=i.readFloat32(),this.heroLevel=i.readInt32(),o>10&&(this.heroStrength=i.readInt32(),this.heroAgility=i.readInt32(),this.heroIntelligence=i.readInt32());for(let t=0,s=i.readInt32();t<s;t++){const r=new I;r.load(i),this.itemsInInventory[t]=r}for(let t=0,s=i.readInt32();t<s;t++){const r=new w;r.load(i),this.modifiedAbilities[t]=r}if(this.randomFlag=i.readInt32(),this.randomFlag===0)i.readUint8Array(this.level),this.itemClass=i.readUint8();else if(this.randomFlag===1)this.unitGroup=i.readUint32(),this.positionInGroup=i.readUint32();else if(this.randomFlag===2)for(let t=0,s=i.readInt32();t<s;t++){const r=new c;r.load(i),this.randomUnitTables[t]=r}this.customTeamColor=i.readInt32(),this.waygate=i.readInt32(),this.creationNumber=i.readInt32()}save(i,e,o,n){i.writeBinary(this.id),i.writeInt32(this.variation),i.writeFloat32Array(this.location),i.writeFloat32(this.angle),i.writeFloat32Array(this.scale),n>131&&i.writeBinary(this.skin),i.writeUint8(this.flags),i.writeInt32(this.player),i.writeUint16(this.unknown),i.writeInt32(this.hitpoints),i.writeInt32(this.mana),o>10&&i.writeInt32(this.droppedItemTable),i.writeInt32(this.droppedItemSets.length);for(const t of this.droppedItemSets)t.save(i);i.writeInt32(this.goldAmount),i.writeFloat32(this.targetAcquisition),i.writeInt32(this.heroLevel),o>10&&(i.writeInt32(this.heroStrength),i.writeInt32(this.heroAgility),i.writeInt32(this.heroIntelligence)),i.writeInt32(this.itemsInInventory.length);for(const t of this.itemsInInventory)t.save(i);i.writeInt32(this.modifiedAbilities.length);for(const t of this.modifiedAbilities)t.save(i);if(i.writeInt32(this.randomFlag),this.randomFlag===0)i.writeUint8Array(this.level),i.writeUint8(this.itemClass);else if(this.randomFlag===1)i.writeUint32(this.unitGroup),i.writeUint32(this.positionInGroup);else if(this.randomFlag===2){i.writeInt32(this.randomUnitTables.length);for(const t of this.randomUnitTables)t.save(i)}i.writeInt32(this.customTeamColor),i.writeInt32(this.waygate),i.writeInt32(this.creationNumber)}getByteLength(i,e,o){let n=91;o>131&&(n+=4),e>10&&(n+=16);for(const t of this.droppedItemSets)n+=t.getByteLength();return n+=this.itemsInInventory.length*8,n+=this.modifiedAbilities.length*12,this.randomFlag===0?n+=4:this.randomFlag===1?n+=8:this.randomFlag===2&&(n+=4+this.randomUnitTables.length*8),n}}class y{version=8;subversion=11;units=[];load(i,e){const o=new a(i);if(o.readBinary(4)!=="W3do")throw new Error("Not a valid war3mapUnits.doo buffer");this.version=o.readInt32(),this.subversion=o.readUint32();for(let n=0,t=o.readInt32();n<t;n++){const s=new g;s.load(o,this.version,this.subversion,e),this.units[n]=s}}save(i){const e=new a(new ArrayBuffer(this.getByteLength(i)));e.writeBinary("W3do"),e.writeInt32(this.version),e.writeUint32(this.subversion),e.writeInt32(this.units.length);for(const o of this.units)o.save(e,this.version,this.subversion,i);return e.uint8array}getByteLength(i){let e=16;for(const o of this.units)e+=o.getByteLength(this.version,this.subversion,i);return e}}export{g as U,y as W};
